{"files":[{"id":"0854e3ef-e581-4734-8d43-767409835a06","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"America/Indiana/Indianapolis\",\n  \"dependencies\": {\n  },\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"sheets\": {\n    \"macros\": [{\n      \"menuName\": \"yuytuytu\",\n      \"functionName\": \"yuytuytu\"\n    }, {\n      \"menuName\": \"NEW_CASES\",\n      \"functionName\": \"NEW_CASES\"\n    }]\n  }\n}"},{"id":"a9adb05c-dec0-44cd-bdd7-76c4f9cd404d","name":"macros","type":"server_js","source":"function QUERY()\n{ var H_ST\u003dSpreadsheetApp.openById(\"1CGx8qzzzq1k4kGK0tLT5A3qzgbThyyVB2uk7ayvbv0Q\").getSheetByName(\u0027GLOBAL\u0027)\n  var D_ST\u003dH_ST.getRange(\u0027A:AX\u0027).getValues()\n  var HREV\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027REV_REP\u0027)\n  var L\u003dHREV.getRange(\u0027G2000\u0027).getNextDataCell(SpreadsheetApp.Direction.UP).getRow()\n\n  if(L\u003e1)\n  {   \n    var Filtro\u003dD_ST.filter(function (v){return v[0]\u003d\u003d\u003d\"ASIGNADO REVISIÓN\"}).map(function (v,i){return [\"Revisión\",v[30],v[15],v[29],v[6],v[17],v[3],v[19],v[21],v[5],v[25],v[26],v[27],v[28],\"PENDIENTE\"]})\n\n    if(Filtro.length\u003e0)\n    {\n    Filtro.forEach(function (v,i,A)\n      { if(v[13]\u003d\u003d\"CASO ANTERIOR NO APROBADO\"){A[i][14]\u003d\"CASO ANTERIOR NO APROBADO\"}\n      else{if(v[13]\u003d\u003d\"SI APLICA\"){A[i][14]\u003d\"REINGRESO\"}\n        else{if(v[10]\u003d\"VENCIDA\"){A[i][14]\u003d\"VENTA DE SERVICIO\"}\n              if(v[10]\u003d\"VIGENTE\"){\n              if(v[11]\u003d\u003d\"VENTA\"){A[i][14]\u003d\"GARANTIA\"}\n              if(v[11]\u003d\u003d\"ARRIENDO\"){A[i][14]\u003d\"ARRIENDO\"}}}}})\n   \n   var Filtro2\u003dFiltro.map(function (v){return [v[0],v[1],v[2],v[3],v[4],v[5],v[6],v[7],v[8],v[9],v[14]]})\n   var LL\u003dFiltro.length +1\n   HREV.getRange(\u0027A2:M\u0027+L).clearContent()\n   HREV.getRange(\u0027A2:K\u0027+LL).setValues(Filtro2)\n   \n   var Filtro3\u003dFiltro2.map(function (v,i){return [v[7],v[10],i+2]}).filter(function (v){return v[1]\u003d\u003d\u003d\"REINGRESO\"})\n\n    for(j\u003d0;j\u003cFiltro3.length;j++)\n    { var SS\u003dFiltro3[j][0].toString()\n      var Index\u003dFiltro3[j][2]\n      var Filtro4\u003dD_ST.filter(function (v){return v[19]\u003d\u003d\u003dSS}).map(function (v){return v[3]})\n       HREV.getRange(\u0027L\u0027+Index).setValue(Filtro4.length)\n       Filtro4.pop()\n       HREV.getRange(\u0027M\u0027+Index).setValue(Filtro4.join())       \n    }\n    }\n    //////////////////////////REPARACION//////////////////////////\n\n  var Filtro5\u003dD_ST.filter(function (v){return v[0]\u003d\u003d\u003d\"ASIGNADO REPARACIÓN\"}).map(function (v){return [\"Reparación\",v[49],v[15],v[48],v[6],v[17],v[3],v[19],v[5],v[25],v[26],v[27],v[34],\"PENDIENTE\"]})\n\nif(Filtro5.length\u003e0)\n{\nFiltro5.forEach(function (v,i,A)\n { if(v[12]\u003d\u003d\"SI APLICA\"){A[i][13]\u003d\"GARANTIA DE REPARACIÓN\"}\n   else{if(v[9]\u003d\"VENCIDA\"){A[i][13]\u003d\"VENTA DE SERVICIO\"}\n        if(v[9]\u003d\"VIGENTE\"){\n          if(v[10]\u003d\u003d\"VENTA\"){A[i][13]\u003d\"GARANTIA\"}\n          if(v[10]\u003d\u003d\"ARRIENDO\"){A[i][13]\u003d\"ARRIENDO\"}}}}) \n\n var Filtro6\u003dFiltro5.map(function (v){return [v[0],v[1],v[2],v[3],v[4],v[5],v[6],v[7],\"-\",v[8],v[13]]})\n\n var LL_\u003dLL+1\n var LLL\u003dFiltro5.length + Filtro.length +1\n\n  HREV.getRange(\u0027A\u0027+LL_+\u0027:K\u0027+LLL).setValues(Filtro6)\n  }\n } else\n { var MAIL \u003d \"jbernal@wi-mobile.com, dbeltran@wi-mobile.com\";\n  var ASUNTO \u003d \"Gerald supera sus límites\";\n  var MENSAJE \u003d \"El presente correo es para comunicar que la jefecita Gerald rompió el archivo DIRECCIONADOR DE REV y REP al asignar más de 2000 actividades!!!\"; \n  GmailApp.sendEmail(MAIL, ASUNTO, MENSAJE);\n\n }\n}\n\n\nfunction ASIGNADOR_V2()\n{ var H_REV\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"REV_REP\")\n  var D_REV\u003dH_REV.getDataRange().getValues()\n  Ult_REV\u003dH_REV.getRange(\u0027G2000\u0027).getNextDataCell(SpreadsheetApp.Direction.UP).getRow()\n\n  if(Ult_REV\u003e1)\n  { var INF\u003dSpreadsheetApp.openById(\"1MLR8RWJeSoBmIxpESLgtP3YZ29NmyvFjcz_I74wnoTc\").getSheetByName(\"Act Abiertas\")\n    var D_INF\u003dINF.getDataRange().getValues()\n    var INF_C\u003dSpreadsheetApp.openById(\"1MLR8RWJeSoBmIxpESLgtP3YZ29NmyvFjcz_I74wnoTc\").getSheetByName(\"Act Cerradas\")\n    var D_INF_C\u003dINF_C.getDataRange().getValues()\n    for(i\u003d1;i\u003cUlt_REV;i++)\n    { var BB\u003dD_REV[i][13].valueOf()\n      if(BB\u003d\u003d0)\n      { var ST\u003dD_REV[i][6].valueOf().toString()\n        var Tec\u003dD_REV[i][3]\n        var Act\u003dD_REV[i][0]\n     \n     var Comp\u003dD_INF.map(function (v,i){return [v[0].valueOf(),v[2],v[4],v[7].valueOf().toString(),v[10],v[14],i+1]})\n    .filter(function (v){return v[3]\u003d\u003d\u003dST\u0026\u0026v[2]\u003d\u003d\u003dAct})\n  \n    var Comp1\u003dComp.filter(function (v){return v[4]\u003d\u003d\u003d\"\"\u0026\u0026v[1]!\u003d\u003dTec}) //Para saber si fue reasignado\n    var Comp2\u003dComp.filter(function (v){return v[1]\u003d\u003d\u003dTec})   // Para saber si ya existe\n    if(Act\u003d\u003d\"Revisión\"){var D\u003d11} else{if(Act\u003d\u003d\"Reparación\"){var D\u003d12}}\n    var Comp3\u003dD_INF_C.filter(function (v){return v[2]\u003d\u003d\u003dTec\u0026\u0026v[4]\u003d\u003d\u003dAct\u0026\u0026v[7]\u003d\u003d\u003dST\u0026\u0026v[D]!\u003d\u003d\"N/A\"})\n\n       if((Comp1.length\u003d\u003d1)\u0026\u0026(Comp2.length\u003d\u003d0)\u0026\u0026(Comp3.length\u003d\u003d0))\n      {  var Ind\u003dComp1.map(function (v){return v[6]})\n       INF.getRange(\u0027A\u0027+Ind+\u0027:C\u0027+Ind).setValues([[D_REV[i][1],D_REV[i][2],D_REV[i][3]]])\n     \n      }\n    if((Comp1.length\u003d\u003d0)\u0026\u0026(Comp2.length\u003d\u003d0)\u0026\u0026(Comp3.length\u003d\u003d0))\n      {var UB\u003dD_REV[i][9].valueOf()\n       var SR\u003dD_REV[i][7].valueOf()\n       var FLL\u003dD_REV[i][8].valueOf()\n       var SEDE\u003dD_REV[i][2]\n       var TIP\u003dD_REV[i][10]\n\n       var U_U\u003dINF.getRange(\u0027A:A\u0027).getLastRow()\n       var UU\u003dINF.getRange(\u0027A\u0027+U_U).getNextDataCell(SpreadsheetApp.Direction.DOWN).getRow()\n       var j\u003dINF.getRange(\u0027A\u0027+UU).getNextDataCell(SpreadsheetApp.Direction.UP).getRow()+1\n       if(j\u003e2)\n       { INF.getRange(\u0027A\u0027+j+\u0027:H\u0027+j).setValues([[D_REV[i][1],D_REV[i][2],D_REV[i][3],D_REV[i][4],Act,D_REV[i][5],D_REV[i][10],D_REV[i][6]]])\n        \n         \n         if(Act\u003d\u003d\"Revisión\"){INF.getRange(\u0027M\u0027+j).setValue(\"N/A\")} else {INF.getRangeList([\u0027L\u0027+j,\u0027N\u0027+j]).setValue(\"N/A\") }\n         \n         if((SEDE\u003d\u003d\"BOGOTÁ\")\u0026\u0026(TIP\u003d\u003d\"REINGRESO\")\u0026\u0026(Act\u003d\u003d\"Revisión\"))\n         {INF.getRange(\u0027H\u0027+j).setNote(\"SERIAL\u003d \"+SR+\"\\nFALLA\u003d \"+FLL+\"\\nUBICACIÓN\u003d \"+UB+\"\\nCANT ING\u003d\"+D_REV[i][11]+\"\\nSERV ANT\u003d\"+D_REV[i][12])}\n         if((SEDE\u003d\u003d\"BOGOTÁ\")\u0026\u0026(TIP!\u003d\"REINGRESO\")\u0026\u0026(Act\u003d\u003d\"Revisión\"))\n         {INF.getRange(\u0027H\u0027+j).setNote(\"SERIAL\u003d \"+SR+\"\\nFALLA\u003d \"+FLL+\"\\nUBICACIÓN\u003d \"+UB)\n          INF.getRange(\u0027M\u0027+j+\u0027:N\u0027+j).setValue(\"N/A\")}\n          if((SEDE!\u003d\"BOGOTÁ\")\u0026\u0026(TIP\u003d\u003d\"REINGRESO\")\u0026\u0026(Act\u003d\u003d\"Revisión\"))\n         {INF.getRange(\u0027H\u0027+j).setNote(\"SERIAL\u003d \"+SR+\"\\nFALLA\u003d \"+FLL+\"\\nCANT ING\u003d\"+D_REV[i][11]+\"\\nSERV ANT\u003d\"+D_REV[i][12])}\n         if((SEDE!\u003d\"BOGOTÁ\")\u0026\u0026(TIP!\u003d\"REINGRESO\")\u0026\u0026(Act\u003d\u003d\"Revisión\"))\n         {INF.getRange(\u0027H\u0027+j).setNote(\"SERIAL\u003d \"+SR+\"\\nFALLA\u003d \"+FLL+\"\\n\")\n          INF.getRange(\u0027M\u0027+j+\u0027:N\u0027+j).setValue(\"N/A\")}\n          if((SEDE\u003d\u003d\"BOGOTÁ\")\u0026\u0026(Act\u003d\u003d\"Reparación\")){INF.getRange(\u0027H\u0027+j).setNote(\"SERIAL\u003d \"+SR+\"\\nUBICACIÓN\u003d \"+UB)}\n         if((SEDE!\u003d\"BOGOTÁ\")\u0026\u0026(Act\u003d\u003d\"Reparación\")){INF.getRange(\u0027H\u0027+j).setNote(\"SERIAL\u003d \"+SR)}\n\n\n       }\n      }\n     }\n    }\n  }\n }\n\n\nfunction MOVE_ROWS()\n{ var INF\u003dSpreadsheetApp.openById(\"1MLR8RWJeSoBmIxpESLgtP3YZ29NmyvFjcz_I74wnoTc\").getSheetByName(\"Act Abiertas\")\n  var D_INF\u003dINF.getDataRange().getValues()\n  var INF_C\u003dSpreadsheetApp.openById(\"1MLR8RWJeSoBmIxpESLgtP3YZ29NmyvFjcz_I74wnoTc\").getSheetByName(\"Act Cerradas\")\n  var D_INF_C\u003dINF_C.getDataRange().getValues()\n\n  var U_C\u003dINF_C.getDataRange().getLastRow()+1\n\n  var Filtro\u003dD_INF.filter(function (v,i){return v[14]!\u003d\u003d\"\"\u0026\u0026i\u003e1})\n\n  if(Filtro.length\u003e0)\n  {var L\u003dFiltro.length+U_C-1\n  Filtro.forEach(function (v,i,A)\n  {if((v[4]\u003d\u003d\"Revisión\")||(v[4]\u003d\u003d\"Reparación\")){A[i][0]\u003d new Date}})\n  \n  INF_C.getRange(\u0027A\u0027+U_C+\u0027:Q\u0027+L).setValues(Filtro)\n\n  var Filtro2\u003dD_INF.map(function (v,i){return [v[14],i+1]}).filter(function (v){return v[0]!\u003d\u003d\"\"\u0026\u0026v[1]\u003e1 })\n\n  for(j\u003dFiltro2.length-1;j\u003e\u003d0;j--)\n  { var RR\u003dFiltro2[j][1]\n\n    INF.deleteRow(RR)\n\n   }\n  }\n}\n\nfunction NEW_QUERY()\n{ var H_ST\u003dSpreadsheetApp.openById(\"1CGx8qzzzq1k4kGK0tLT5A3qzgbThyyVB2uk7ayvbv0Q\").getSheetByName(\u0027GLOBAL\u0027)\n  var D_ST\u003dH_ST.getRange(\u0027A:AU\u0027).getValues()\n  var GrupoTec\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027VAL\u0027).getRange(\u0027H1:H7\u0027).getValues()\n\n  for(i\u003d1;i\u003c\u003d6;i++)\n  { var GTec\u003dGrupoTec[i][0]\n    var HREV\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027REV_\u0027+i)\n    var L\u003dHREV.getRange(\u0027H500\u0027).getNextDataCell(SpreadsheetApp.Direction.UP).getRow()\n    \n    var Filtro\u003dD_ST.filter(function (v){return v[0]\u003d\u003d\u003d\"ASIGNADO REVISIÓN\"\u0026\u0026GTec.toString().indexOf(v[27],0)\u003e-1}).map(function (v,i){return [\"Revisión\",v[28],v[15],v[27],v[6],v[16],v[17],v[18],v[3],v[19],v[21],v[5],v[23],v[24],v[25],v[26],\"PENDIENTE\"]})\n\n    if(Filtro.length\u003e0)\n    {\n    Filtro.forEach(function (v,i,A)\n      { if(v[15]\u003d\u003d\"SI APLICA\"){A[i][16]\u003d\"REINGRESO\"}\n        else{if(v[12]\u003d\"VENCIDA\"){A[i][16]\u003d\"VENTA DE SERVICIO\"}\n              if(v[12]\u003d\"VIGENTE\"){\n              if(v[13]\u003d\u003d\"VENTA\"){A[i][16]\u003d\"GARANTIA\"}\n              if(v[13]\u003d\u003d\"ARRIENDO\"){A[i][16]\u003d\"ARRIENDO\"}}}})\n   \n   var Filtro2\u003dFiltro.map(function (v){return [v[0],v[1],v[2],v[3],v[4],v[5],v[6],v[7],v[8],v[9],v[10],v[11],v[16]]})\n   var LL\u003dFiltro.length +1\n   HREV.getRange(\u0027A2:O\u0027+L).clearContent()\n   HREV.getRange(\u0027A2:M\u0027+LL).setValues(Filtro2)\n   \n   var Filtro3\u003dFiltro2.map(function (v,i){return [v[9],v[12],i+2]}).filter(function (v){return v[1]\u003d\u003d\u003d\"REINGRESO\"})\n\n    for(j\u003d0;j\u003cFiltro3.length;j++)\n    { var SS\u003dFiltro3[j][0].toString()\n      var Index\u003dFiltro3[j][2]\n      var Filtro4\u003dD_ST.filter(function (v){return v[19]\u003d\u003d\u003dSS}).map(function (v){return v[3]})\n       HREV.getRange(\u0027N\u0027+Index).setValue(Filtro4.length)\n       Filtro4.pop()\n       HREV.getRange(\u0027O\u0027+Index).setValue(Filtro4.join())       \n    }\n    }\n    //////////////////////////REPARACION//////////////////////////\n\n  var Filtro5\u003dD_ST.filter(function (v){return v[0]\u003d\u003d\u003d\"ASIGNADO REPARACIÓN\"\u0026\u0026GTec.toString().indexOf(v[45],0)\u003e-1}).map(function (v){return [\"Reparación\",v[46],v[15],v[45],v[6],v[16],v[17],v[18],v[3],v[19],v[5],v[23],v[24],v[25],v[32],\"PENDIENTE\"]})\n\nif(Filtro5.length\u003e0)\n{\nFiltro5.forEach(function (v,i,A)\n { if(v[14]\u003d\u003d\"SI APLICA\"){A[i][15]\u003d\"GARANTIA DE REPARACIÓN\"}\n   else{if(v[11]\u003d\"VENCIDA\"){A[i][15]\u003d\"VENTA DE SERVICIO\"}\n        if(v[11]\u003d\"VIGENTE\"){\n          if(v[12]\u003d\u003d\"VENTA\"){A[i][15]\u003d\"GARANTIA\"}\n          if(v[12]\u003d\u003d\"ARRIENDO\"){A[i][15]\u003d\"ARRIENDO\"}}}}) \n\n var Filtro6\u003dFiltro5.map(function (v){return [v[0],v[1],v[2],v[3],v[4],v[5],v[6],v[7],v[8],v[9],\"-\",v[10],v[15]]})\n\n var LL_\u003dLL+1\n var LLL\u003dFiltro5.length + Filtro.length +1\n\n  HREV.getRange(\u0027A\u0027+LL_+\u0027:M\u0027+LLL).setValues(Filtro6)\n  }\n }\n}\n\n\nfunction ASIGNADOR()\n{ var GrupoTec\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027VAL\u0027).getRange(\u0027J1:J7\u0027).getValues()\n\nfor (k\u003d1;k\u003c\u003d6;k++)\n{ var Enl\u003dGrupoTec[k][0]\n\n  var H_REV\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"REV_\"+k)\n  var D_REV\u003dH_REV.getDataRange().getValues()\n  Ult_REV\u003dH_REV.getRange(\u0027I500\u0027).getNextDataCell(SpreadsheetApp.Direction.UP).getRow()\n\n  if(Ult_REV\u003e1)\n  { var INF\u003dSpreadsheetApp.openById(Enl).getSheetByName(\"Actividades\")\n    var D_INF\u003dINF.getDataRange().getValues()\n    for(i\u003d1;i\u003cUlt_REV;i++)\n    { var BB\u003dD_REV[i][15].valueOf()\n      if(BB\u003d\u003d0)\n      { var ST\u003dD_REV[i][8].valueOf().toString()\n        var Tec\u003dD_REV[i][3]\n        var Act\u003dD_REV[i][0]\n     \n     var Comp\u003dD_INF.map(function (v,i){return [v[2].valueOf(),v[5],v[7],v[12].valueOf().toString(),v[15],v[19],i+1]})\n    .filter(function (v){return v[3]\u003d\u003d\u003dST\u0026\u0026v[2]\u003d\u003d\u003dAct})\n  \n    var Comp1\u003dComp.filter(function (v){return v[4]\u003d\u003d\u003d\"\"\u0026\u0026v[1]!\u003d\u003dTec}) //Para saber si fue reasignado\n    var Comp2\u003dComp.filter(function (v){return v[1]\u003d\u003d\u003dTec})   // Para saber si ya existe\n\n       if((Comp1.length\u003d\u003d1)\u0026\u0026(Comp2.length\u003d\u003d0))\n      {  var Ind\u003dComp1.map(function (v){return v[6]})\n       INF.getRange(\u0027C\u0027+Ind).setValue(D_REV[i][1])\n       INF.getRange(\u0027E\u0027+Ind+\u0027:G\u0027+Ind).setValues([[D_REV[i][2],D_REV[i][3],D_REV[i][4]]])\n      }\n    if((Comp1.length\u003d\u003d0)\u0026\u0026(Comp2.length\u003d\u003d0))\n      {var UB\u003dD_REV[i][11].valueOf()\n       var SR\u003dD_REV[i][9].valueOf()\n       var FLL\u003dD_REV[i][10].valueOf()\n       var SEDE\u003dD_REV[i][2]\n       var TIP\u003dD_REV[i][12]\n\n       var UU\u003dINF.getRange(\u0027C:C\u0027).getLastRow()\n       var j\u003dINF.getRange(\u0027C\u0027+UU).getNextDataCell(SpreadsheetApp.Direction.UP).getRow()+1\n       if(j\u003e2)\n       { INF.getRange(\u0027C\u0027+j).setValue(D_REV[i][1])\n         INF.getRange(\u0027E\u0027+j+\u0027:G\u0027+j).setValues([[D_REV[i][2],D_REV[i][3],D_REV[i][4]]])\n         INF.getRange(\u0027H\u0027+j).setValue(Act)\n         INF.getRange(\u0027I\u0027+j+\u0027:M\u0027+j).setValues([[D_REV[i][5],D_REV[i][6],D_REV[i][7],D_REV[i][12],D_REV[i][8]]])\n         \n         if(Act\u003d\u003d\"Revisión\"){INF.getRange(\u0027R\u0027+j).setValue(\"N/A\")} else {INF.getRange(\u0027Q\u0027+j).setValue(\"N/A\") }\n         \n         if((SEDE\u003d\u003d\"BOGOTÁ\")\u0026\u0026(TIP\u003d\u003d\"REINGRESO\")\u0026\u0026(Act\u003d\u003d\"Revisión\"))\n         {INF.getRange(\u0027M\u0027+j).setNote(\"SERIAL\u003d \"+SR+\"\\nFALLA\u003d \"+FLL+\"\\nUBICACIÓN\u003d \"+UB+\"\\nCANT ING\u003d\"+D_REV[i][13]+\"\\nSERV ANT\u003d\"+D_REV[i][14])}\n         if((SEDE\u003d\u003d\"BOGOTÁ\")\u0026\u0026(TIP!\u003d\"REINGRESO\")\u0026\u0026(Act\u003d\u003d\"Revisión\"))\n         {INF.getRange(\u0027M\u0027+j).setNote(\"SERIAL\u003d \"+SR+\"\\nFALLA\u003d \"+FLL+\"\\nUBICACIÓN\u003d \"+UB)\n          INF.getRange(\u0027R\u0027+j+\u0027:S\u0027+j).setValue(\"N/A\")}\n          if((SEDE!\u003d\"BOGOTÁ\")\u0026\u0026(TIP\u003d\u003d\"REINGRESO\")\u0026\u0026(Act\u003d\u003d\"Revisión\"))\n         {INF.getRange(\u0027M\u0027+j).setNote(\"SERIAL\u003d \"+SR+\"\\nFALLA\u003d \"+FLL+\"\\nCANT ING\u003d\"+D_REV[i][13]+\"\\nSERV ANT\u003d\"+D_REV[i][14])}\n         if((SEDE!\u003d\"BOGOTÁ\")\u0026\u0026(TIP!\u003d\"REINGRESO\")\u0026\u0026(Act\u003d\u003d\"Revisión\"))\n         {INF.getRange(\u0027M\u0027+j).setNote(\"SERIAL\u003d \"+SR+\"\\nFALLA\u003d \"+FLL+\"\\n\")\n          INF.getRange(\u0027R\u0027+j+\u0027:S\u0027+j).setValue(\"N/A\")}\n          if((SEDE\u003d\u003d\"BOGOTÁ\")\u0026\u0026(Act\u003d\u003d\"Reparación\"))\n          {INF.getRange(\u0027M\u0027+j).setNote(\"SERIAL\u003d \"+SR+\"\\nUBICACIÓN\u003d \"+UB)}\n         else{INF.getRange(\u0027M\u0027+j).setNote(\"SERIAL\u003d \"+SR)}\n\n\n       }\n      }\n     }\n    }\n  }\n }\n}\n\n\n\nfunction NEW_REV_REP()\n{ var G\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"VAL\").getRange(\u0027B1\u0027).getValue()\n Logger.log(G)\n  \n  if(G\u003d\u003d0)\n  { SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"VAL\").getRange(\u0027B1\u0027).setValue(1)\n    SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"VAL\").getRange(\u0027C1\u0027).setValue(\"\")\n    SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"VAL\").getRange(\u0027B3\u0027).setValue(\"TOMANDO DATA REV\")\n    SpreadsheetApp.flush()\n    REV()\n    SpreadsheetApp.flush()\n  var H_REV\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"REV\") //Hoja de Revisiones\n  var INF\u003dSpreadsheetApp.openById(\"1MLR8RWJeSoBmIxpESLgtP3YZ29NmyvFjcz_I74wnoTc\").getSheetByName(\"Actividades\") //Hoja del Drive de actividades diarias diligenciados por los tecnicos\n  var D_REV\u003dH_REV.getDataRange().getValues() //Data de la hoja de revisiones\n  var Ult_REV\u003dH_REV.getRange(\u0027H800\u0027).getNextDataCell(SpreadsheetApp.Direction.UP).getRow() //Fila del Ultimo valor de la hoja de revisiones\n  \n SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"VAL\").getRange(\u0027C3\u0027).setValue(\"REV\")\n if(Ult_REV\u003e1)\n { var D_INF\u003dINF.getDataRange().getValues()   //Data de la hoja de Informe de actividades diarias\n   for(i\u003d1;i\u003cUlt_REV;i++)\n   { SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"VAL\").getRange(\u0027C1\u0027).setValue(i)\n     \n     var BB\u003dD_REV[i][14].valueOf()\n        \n    if(BB\u003d\u003d0)\n    { \n    var ST\u003dD_REV[i][7].valueOf().toString()\n    var Tec\u003dD_REV[i][2]\n     \n     var Comp\u003dD_INF.map(function (v,i){return [v[2].valueOf(),v[5],v[7],v[12].valueOf().toString(),v[15],v[19],i+1]})\n    .filter(function (v){return v[3]\u003d\u003d\u003dST\u0026\u0026v[2]\u003d\u003d\u003d\"Revisión\"})\n  \n    var Comp1\u003dComp.filter(function (v){return v[4]\u003d\u003d\u003d\"\"\u0026\u0026v[1]!\u003d\u003dTec}) //Para saber si fue reasignado\n    var Comp2\u003dComp.filter(function (v){return v[1]\u003d\u003d\u003dTec})   // Para saber si ya existe\n\n       if((Comp1.length\u003d\u003d1)\u0026\u0026(Comp2.length\u003d\u003d0))\n      {  var Ind\u003dComp1.map(function (v){return v[6]})\n       var Data1\u003dD_REV[i][0]\n       //var Data2\u003d[D_REV[i][1],D_REV[i][2],D_REV[i][3]]\n       INF.getRange(\u0027C\u0027+Ind).setValue(Data1)\n       INF.getRange(\u0027E\u0027+Ind+\u0027:G\u0027+Ind).setValues([[D_REV[i][1],D_REV[i][2],D_REV[i][3]]])\n      }\n    if((Comp1.length\u003d\u003d0)\u0026\u0026(Comp2.length\u003d\u003d0))\n      {var UB\u003dD_REV[i][10].valueOf()\n       var SR\u003dD_REV[i][8].valueOf()\n       var FLL\u003dD_REV[i][9].valueOf()\n       var SEDE\u003dD_REV[i][1]\n       var TIP\u003dD_REV[i][11]\n\n       var UU\u003dINF.getRange(\u0027C:C\u0027).getLastRow()\n       var j\u003dINF.getRange(\u0027C\u0027+UU).getNextDataCell(SpreadsheetApp.Direction.UP).getRow()+1\n       if(j\u003e2)\n       { INF.getRange(\u0027C\u0027+j).setValue(D_REV[i][0])\n         INF.getRange(\u0027E\u0027+j+\u0027:G\u0027+j).setValues([[D_REV[i][1],D_REV[i][2],D_REV[i][3]]])\n         INF.getRange(\u0027H\u0027+j).setValue(\"Revisión\")\n         INF.getRange(\u0027I\u0027+j+\u0027:M\u0027+j).setValues([[D_REV[i][4],D_REV[i][5],D_REV[i][6],D_REV[i][11],D_REV[i][7]]])\n         INF.getRange(\u0027R\u0027+j).setValue(\"N/A\")\n         if((SEDE\u003d\u003d\"BOGOTÁ\")\u0026\u0026(TIP\u003d\u003d\"REINGRESO\"))\n         {INF.getRange(\u0027M\u0027+j).setNote(\"SERIAL\u003d \"+SR+\"\\nFALLA\u003d \"+FLL+\"\\nUBICACIÓN\u003d \"+UB+\"\\nCANT ING\u003d\"+D_REV[i][12]+\"\\nSERV ANT\u003d\"+D_REV[i][13])}\n         if((SEDE\u003d\u003d\"BOGOTÁ\")\u0026\u0026(TIP!\u003d\"REINGRESO\"))\n         {INF.getRange(\u0027M\u0027+j).setNote(\"SERIAL\u003d \"+SR+\"\\nFALLA\u003d \"+FLL+\"\\nUBICACIÓN\u003d \"+UB)\n          INF.getRange(\u0027R\u0027+j+\u0027:S\u0027+j).setValue(\"N/A\")}\n          if((SEDE!\u003d\"BOGOTÁ\")\u0026\u0026(TIP\u003d\u003d\"REINGRESO\"))\n         {INF.getRange(\u0027M\u0027+j).setNote(\"SERIAL\u003d \"+SR+\"\\nFALLA\u003d \"+FLL+\"\\nCANT ING\u003d\"+D_REV[i][12]+\"\\nSERV ANT\u003d\"+D_REV[i][13])}\n         if((SEDE!\u003d\"BOGOTÁ\")\u0026\u0026(TIP!\u003d\"REINGRESO\"))\n         {INF.getRange(\u0027M\u0027+j).setNote(\"SERIAL\u003d \"+SR+\"\\nFALLA\u003d \"+FLL+\"\\n\")\n          INF.getRange(\u0027R\u0027+j+\u0027:S\u0027+j).setValue(\"N/A\")}\n\n        var D_INF\u003dINF.getDataRange().getValues()   //Data de la hoja de Informe de actividades diarias\n         SpreadsheetApp.flush()\n       }\n      }\n    }SpreadsheetApp.flush()\n   }     \n  }\nSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"VAL\").getRange(\u0027B3\u0027).setValue(\"TOMANDO DATA REP\")\nREP()\nSpreadsheetApp.flush()\nvar H_REP\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"REP\") //HOja de Reparaciones\nvar D_REP\u003dH_REP.getDataRange().getValues() //Data de la hoja de reparaciones\nvar Ult_REP\u003dH_REP.getRange(\u0027H500\u0027).getNextDataCell(SpreadsheetApp.Direction.UP).getRow()//Fila del Ultimo valor de la hoja de reparaciones\nSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"VAL\").getRange(\u0027C3\u0027).setValue(\"REP\")\nif(Ult_REP\u003e1)\n {var D_INF\u003dINF.getDataRange().getValues()   //Data de la hoja de Informe de actividades diarias\n   for(i\u003d1;i\u003cUlt_REP;i++)\n   {SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"VAL\").getRange(\u0027C1\u0027).setValue(i)\n   \n    var BB\u003dD_REP[i][11].valueOf()\n    \n    if(BB\u003d\u003d0)\n    {\n    var ST\u003dD_REP[i][7].valueOf().toString()\n    var Tec\u003dD_REP[i][2]\n    \n    var Comp\u003dD_INF.map(function (v,i){return [v[2].valueOf(),v[5],v[7],v[12].valueOf().toString(),v[15],v[19],i+1]})\n    .filter(function (v){return v[3]\u003d\u003d\u003dST\u0026\u0026v[2]\u003d\u003d\u003d\"Reparación\"})\n  \n    var Comp1\u003dComp.filter(function (v){return v[4]\u003d\u003d\u003d\"\"\u0026\u0026v[1]!\u003d\u003dTec}) //Para saber si fue reasignado\n    var Comp2\u003dComp.filter(function (v){return v[1]\u003d\u003d\u003dTec}) // Para saber si ya existe\n\n    if((Comp1.length\u003d\u003d1)\u0026\u0026(Comp2.length\u003d\u003d0))\n      {  var Ind\u003dComp1.map(function (v){return v[6]})\n       var Data1\u003dD_REP[i][0]\n       //var Data2\u003d([D_REP[i][1]],[D_REP[i][2]],[D_REP[i][3]])\n       INF.getRange(\u0027C\u0027+Ind).setValue(Data1)\n       INF.getRange(\u0027E\u0027+Ind+\u0027:G\u0027+Ind).setValues([[D_REP[i][1],D_REP[i][2],D_REP[i][3]]])\n      }\n    if((Comp1.length\u003d\u003d0)\u0026\u0026(Comp2.length\u003d\u003d0))\n      {var Data1\u003dD_REP[i][0]\n       var Data4\u003dD_REP[i][7]\n       var UB\u003dD_REP[i][9].valueOf()\n       var SR\u003dD_REP[i][8].valueOf()\n       var SEDE\u003dD_REP[i][1]\n    \n       var UU\u003dINF.getRange(\u0027C:C\u0027).getLastRow()\n       var j\u003dINF.getRange(\u0027C\u0027+UU).getNextDataCell(SpreadsheetApp.Direction.UP).getRow()+1\n       if(j\u003e2)\n       { INF.getRange(\u0027C\u0027+j).setValue(Data1)\n         INF.getRange(\u0027E\u0027+j+\u0027:G\u0027+j).setValues([[D_REP[i][1],D_REP[i][2],D_REP[i][3]]])\n         INF.getRange(\u0027H\u0027+j).setValue(\"Reparación\")\n         INF.getRange(\u0027I\u0027+j+\u0027:K\u0027+j).setValues([[D_REP[i][4],D_REP[i][5],D_REP[i][6]]])\n         INF.getRange(\u0027M\u0027+j).setValue(Data4)\n         INF.getRange(\u0027Q\u0027+j).setValue(\"N/A\")\n         INF.getRange(\u0027S\u0027+j).setValue(\"N/A\")\n         if(SEDE\u003d\u003d\"BOGOTÁ\")\n          {INF.getRange(\u0027M\u0027+j).setNote(\"SERIAL\u003d \"+SR+\"\\nUBICACIÓN\u003d \"+UB)}\n         else{INF.getRange(\u0027M\u0027+j).setNote(\"SERIAL\u003d \"+SR)}\n         var D_INF\u003dINF.getDataRange().getValues()   //Data de la hoja de Informe de actividades diarias\n         SpreadsheetApp.flush()\n       }\n      }  \n    } SpreadsheetApp.flush()\n   }   \n  }SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"VAL\").getRange(\u0027B1\u0027).setValue(0)\n  SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"VAL\").getRange(\u0027B3\u0027).setValue(\"\")\n }\n //Utilities.sleep(3000)\n}\n \n\nfunction PROTECCION_FILAS()\n{var INF\u003dSpreadsheetApp.openById(\"1MLR8RWJeSoBmIxpESLgtP3YZ29NmyvFjcz_I74wnoTc\").getSheetByName(\"Actividades\")\n var Filas\u003dSpreadsheetApp.openById(\"1MLR8RWJeSoBmIxpESLgtP3YZ29NmyvFjcz_I74wnoTc\").getSheetByName(\"-\u003e\")\n var D_INF\u003dINF.getDataRange().getValues()\n var D_Filas\u003dFilas.getDataRange().getValues()\n var F\u003dFilas.getRange(\u0027A500\u0027).getNextDataCell(SpreadsheetApp.Direction.UP).getRow()\n Logger.log(F)\n while(F\u003e1)\n   { var h\u003dF-1\n     var Index\u003dD_Filas[h][0].valueOf()\n     if(Index!\u003d\"\")\n     { INF.getRange(Index+\u0027:\u0027+Index).setBackground(\"white\")\n       Filas.getRange(\u0027A\u0027+F).clearContent()\n     var INFO\u003dD_INF.map(function (v,i){return [v[7],v[12],new Date,v[15],v[16],v[17]]})\n     .filter(function (v,i){return i+1\u003d\u003dIndex})\n     \n     if((INFO[0][0]\u003d\u003d\"Revisión\")\u0026\u0026(INFO[0][4]!\u003d\"N/A\"))\n     { INF.getRange(\u0027A\u0027+Index+\u0027:T\u0027+Index).protect().removeEditors([\u0027soportetecnico_bogota_01@wi-mobile.com\u0027, \u0027soportetecnico_bogota_02@wi-mobile.com\u0027,\u0027soportetecnico_bogota_03@wi-mobile.com\u0027,\u0027soportetecnico_bogota_04@wi-mobile.com\u0027,\u0027soportetecnico_medellin@wi-mobile.com\u0027,\u0027mmarroquin@wi-mobile.com\u0027,\u0027julynalber@gmail.com\u0027])    \n     }\n     if((INFO[0][0]\u003d\u003d\"Reparación\")\u0026\u0026(INFO[0][5]!\u003d\"N/A\"))\n     { INF.getRange(\u0027A\u0027+Index+\u0027:T\u0027+Index).protect().removeEditors([\u0027soportetecnico_bogota_01@wi-mobile.com\u0027, \u0027soportetecnico_bogota_02@wi-mobile.com\u0027,\u0027soportetecnico_bogota_03@wi-mobile.com\u0027,\u0027soportetecnico_bogota_04@wi-mobile.com\u0027,\u0027soportetecnico_medellin@wi-mobile.com\u0027,\u0027mmarroquin@wi-mobile.com\u0027,\u0027julynalber@gmail.com\u0027])\n\n     }  \n   } var F\u003dFilas.getRange(\u0027A500\u0027).getNextDataCell(SpreadsheetApp.Direction.UP).getRow()\n  }\n }\n\n\nfunction REPUESTOS()\n{\n  var REPUESTOS\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"DIAG\u0026SELLOS\")\n  var D_REP\u003dREPUESTOS.getDataRange().getValues()\n  var L_REP\u003dREPUESTOS.getDataRange().getLastRow()\n  var Enc\u003dREPUESTOS.getRange(1,7,1,5).getValues()\n  var L_Enc\u003dEnc[0].length\n\n  for(i\u003d1;i\u003c12;i++)  //Cantidad de casos por filas\n  { var REPS\u003dD_REP[i][4].toString().toUpperCase()\n     var REPInd\u003dREPS.toString().split(\",\")\n     var C_Rep\u003dREPInd.length //Cantidad de repuestos por caso\n     \n    for(j\u003d0;j\u003cC_Rep;j++)\n    { var LL\u003dREPInd[j].toString().trim().indexOf(\"(\",0)\n      var REP\u003dREPInd[j].toString().trim().slice(0,LL).trim()\n      var TIP\u003dREPInd[j].toString().trim().slice(LL,LL+4)\n      var Div\u003dREP.toString().split(\" \")\n      var Ll\u003dDiv.length\n       \n      for(k\u003d0;k\u003cL_Enc;k++)\n      {var R_Enc\u003dEnc[0][k]\n       var Cont\u003d0\n       for(l\u003d0;l\u003cLl;l++)\n       { var RR\u003dDiv[l].toString()\n         var Comp\u003dR_Enc.toString().indexOf(RR,0)\n         if(Comp!\u003d-1)\n         { Cont\u003dCont+1}\n       } var Val\u003dCont/Ll\n         var CC\u003dREPUESTOS.getRange(i+1,k+7).getValue()\n         if(Val\u003eCC)\n         {REPUESTOS.getRange(i+1,k+7).setValue(Val)}\n       \n      }\n    }\n  }\n}\n\nfunction ACTIVE()\n{ var F\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"VAL\").getRange(\u0027B1\u0027).getValue()\nLogger.log(\u0027F\u003d\u0027+F)\n if (F\u003d\u003d1)\n {for(i\u003d0;i\u003c\u003d10;i++)\n {var G\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"VAL\").getRange(\u0027C1\u0027).getValue()\n   SpreadsheetApp.flush()\n  Logger.log(\u0027G\u003d\u0027+G)\n  Utilities.sleep(8000)\n  var H\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"VAL\").getRange(\u0027C1\u0027).getValue()\n  SpreadsheetApp.flush()\n  Logger.log(\u0027H\u003d\u0027+H)\n  \n  if(G\u003d\u003dH)\n  { var J\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"VAL\").getRange(\u0027B2\u0027).getValue()\n  Logger.log(\u0027J\u003d\u0027+J)\n    SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"VAL\").getRange(\u0027B2\u0027).setValue(J+1)\n    if(J\u003d\u003d10)\n    { SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"VAL\").getRangeList([\u0027B1\u0027,\u0027B2\u0027]).setValue(0)\n\n    }\n   }\n  }SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"VAL\").getRange(\u0027B2\u0027).setValue(0)\n }\n}\n\nfunction P()\n{var MAIL \u003d \"jbernal@wi-mobile.com , \";\n  var ASUNTO \u003d \"Gerald supera sus límites\";\n  var MENSAJE \u003d \"El presente correo es para comunicar que la jefecita Gerald rompió el archivo DIRECCIONADOR DE REV y REP al asignar más de 2000 actividades!!!\"; \n  GmailApp.sendEmail(MAIL, ASUNTO, MENSAJE);\n\n}\n\n\n\n"}]}