{"files":[{"id":"653759c8-1ce2-4347-9026-30464a801582","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"America/New_York\",\n  \"dependencies\": {\n  },\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"sheets\": {\n    \"macros\": [{\n      \"menuName\": \"BORRA_PROTECT_FILA\",\n      \"functionName\": \"BORRA_PROTECT_FILA\"\n    }, {\n      \"menuName\": \"tststst\",\n      \"functionName\": \"tststst\"\n    }, {\n      \"menuName\": \"msdm\",\n      \"functionName\": \"msdm\"\n    }, {\n      \"menuName\": \"ORDENAR_\",\n      \"functionName\": \"ORDENAR_\"\n    }]\n  }\n}"},{"id":"ec75d27e-4dad-476c-8fbe-3ca84913e6f9","name":"Código","type":"server_js","source":"function onEdit(e) \n{ if(e.source.getActiveSheet().getName()\u003d\u003d\"Act Abiertas\")\n  { var F\u003de.range.getRow()\n    var C\u003de.range.getColumn()\n    var V\u003de.value\n\n    //SpreadsheetApp.getActiveSpreadsheet().toast(\"Prueba\",\"Aviso\",3)\n\n    if((C\u003d\u003d12)\u0026\u0026(V\u003d\u003d\"N/A\"))\n    { var Act\u003dSpreadsheetApp.getActiveSheet().getRange(\u0027E\u0027+F).getValue()\n      if(Act\u003d\u003d\"Revisión\")\n      {\n      SpreadsheetApp.getActiveSpreadsheet().toast(\"Si en la revisión se determina que no requiere repuestos se debe colocar Ninguno. No confundir con N/A\",\u0027Aviso\u0027,10);\n      }\n    }\n  }\n\n  if(e.source.getActiveSheet().getName()\u003d\u003d\"Act Cerradas\")\n  { var F\u003de.range.getRow()\n    var C\u003de.range.getColumn()\n    var V\u003de.value\n \n  if(((C\u003e\u003d1)\u0026\u0026(C\u003c\u003d10)||(C\u003d\u003d15))\u0026\u0026(V!\u003d\"\"))\n  { SpreadsheetApp.getActiveSheet().getRange(F,C).setBackground(\"yellow\")}\n   \n }\n}\n  //setNumberFormat(\u0027dd/MM/yyyy HH:mm:ss\u0027);\n    //   if((C\u003d\u003d20)\u0026\u0026(V!\u003dnull))\n    // { var TS\u003dSpreadsheetApp.getActiveSheet().getRange(\u0027H\u0027+F).getValue()\n    //   if((TS\u003d\u003d\"Revisión\")||(TS\u003d\u003d\"Reparación\"))\n    //   { SpreadsheetApp.getActiveSheet().getRange(\u0027C\u0027+F).setValue(new Date)}\n    //   var PP\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"-\u003e\")\n    //   var FF\u003dPP.getRange(\u0027A500\u0027).getNextDataCell(SpreadsheetApp.Direction.UP).getRow()+1\n    //   PP.getRange(\u0027A\u0027+FF).setValue(F)    \n    // }\n\n    // if((C\u003d\u003d8)\u0026\u0026(V!\u003dnull))\n    //   { if(V\u003d\u003d\u0027Revisión\u0027){SpreadsheetApp.getActiveSheet().getRange(\u0027R\u0027+F).setValue(\"N/A\")}\n    //     if(V\u003d\u003d\u0027Reparación\u0027){SpreadsheetApp.getActiveSheet().getRange(\u0027Q\u0027+F).setValue(\"N/A\")}\n    //     if(V\u003d\u003d\u0027Alistamiento\u0027){SpreadsheetApp.getActiveSheet().getRangeList([\u0027L\u0027+F,\u0027Q\u0027+F+\u0027:S\u0027+F]).setValue(\"N/A\")}\n    //     if(V\u003d\u003d\u0027Gestión soporte\u0027){SpreadsheetApp.getActiveSheet().getRangeList([\u0027L\u0027+F,\u0027Q\u0027+F+\u0027:S\u0027+F]).setValue(\"N/A\")}\n    //  }\n\n    // if((C\u003d\u003d17)\u0026\u0026(V!\u003dnull))\n    // { var TS\u003dSpreadsheetApp.getActiveSheet().getRange(\u0027H\u0027+F).getValue()\n    //   var Rep\u003dV.toString().indexOf(\"ingun\",0)\n    //  // SpreadsheetApp.getActiveSpreadsheet().toast(\"Si en la revisión se determina que no requiere repuestos se debe colocar Ninguno. No confundir con N/A\",\u0027Aviso\u0027,10);\n\n    //   if((TS\u003d\u003d\"Revisión\"))\n    //   { //SpreadsheetApp.getActiveSheet().getRange(\u0027C\u0027+F).setValue(new Date)\n    //     var PP\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"-\u003e\")\n    //     var FF\u003dPP.getRange(\u0027A1\u0027).getValue()\n    //     //PP.getRange(\u0027A\u0027+FF).setValue(F)      \n    //   }\n    // }\n\n  //}\n//}\n\nfunction MODELOS_CLIENTES()\n{ var CLIENTES\u003dSpreadsheetApp.openById(\"1CGx8qzzzq1k4kGK0tLT5A3qzgbThyyVB2uk7ayvbv0Q\").getSheetByName(\u0027D\u0027) //Clientes\n  var MODELO\u003dSpreadsheetApp.openById(\"1CGx8qzzzq1k4kGK0tLT5A3qzgbThyyVB2uk7ayvbv0Q\").getSheetByName(\u0027C\u0027) //Modelos\n  var H_C\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027Clientes\u0027)\n  var H_M\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027Marca y Modelo\u0027)\n\nvar L_C\u003dCLIENTES.getDataRange().getLastRow()+5\nvar L_M\u003dMODELO.getDataRange().getLastRow()+5\n\nH_C.getRange(\u0027A2:A\u0027+L_C).setValues(CLIENTES.getRange(\u0027A2:A\u0027+L_C).getValues())\nH_M.getRange(\u0027A1:C\u0027+L_M).setValues(MODELO.getRange(\u0027A1:C\u0027+L_M).getValues())\n\n}\n\nfunction MOVE_ROWS()\n{ var DIR\u003dSpreadsheetApp.openById(\"1nO_F5hIAGWV06PEhInnUZDhOaq5Z77_1GBAEzQodzQk\").getSheetByName(\"VAL\")\n  var SW\u003dDIR.getRange(\u0027B1\u0027).getValue()\n  Logger.log(SW)\n\n  if(SW\u003d\u003d0)\n  { DIR.getRange(\u0027B1\u0027).setValue(1)\n  SpreadsheetApp.flush()\n  var INF\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"Act Abiertas\")\n  var D_INF\u003dINF.getDataRange().getValues()\n  var INF_C\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"Act Cerradas\")\n  var D_INF_C\u003dINF_C.getDataRange().getValues()\n  var D_Sedes\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"Personal\").getDataRange().getValues()\n\n  var U_C\u003dINF_C.getDataRange().getLastRow()+1\n\n  var Filtro\u003dD_INF.filter(function (v,i){return v[14]!\u003d\u003d\"\"\u0026\u0026i\u003e1})\n\n  if(Filtro.length\u003e0)\n  {var L\u003dFiltro.length+U_C-1\n  Filtro.forEach(function (v,i,A)\n  {if((v[4]\u003d\u003d\"Revisión\")||(v[4]\u003d\u003d\"Reparación\")){A[i][0]\u003d new Date}\n   var Tec\u003dv[2]\n   var Filtro1\u003d D_Sedes.filter(function (v){return v[0]\u003d\u003d\u003dTec})\n   var SS\u003dFiltro1[0][1]\n   A[i][1]\u003dSS\n  }\n  \n  )\n  \n  INF_C.getRange(\u0027A\u0027+U_C+\u0027:Q\u0027+L).setValues(Filtro)\n\n  var Filtro2\u003dD_INF.map(function (v,i){return [v[14],i+1]}).filter(function (v){return v[0]!\u003d\u003d\"\"\u0026\u0026v[1]\u003e1 })\n\n  for(j\u003dFiltro2.length-1;j\u003e\u003d0;j--)\n  { var RR\u003dFiltro2[j][1]\n\n    INF.deleteRow(RR)\n\n   }\n  }\n }DIR.getRange(\u0027B1\u0027).setValue(0)\n\n}\n\n\n// function ORDENAR()\n// {\n//   var HAct\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027Actividades\u0027)\n//   var Ult\u003dHAct.getDataRange().getLastRow()\n//   Logger.log(\"Ult\u003d\"+Ult)\n//   var UU\u003dHAct.getRange(\u0027C\u0027+Ult).getNextDataCell(SpreadsheetApp.Direction.UP).getRow()+1\n//   Logger.log(\"UU\u003d\"+UU)\n//   var VV\u003dHAct.getRange(\u0027O\u0027+Ult).getNextDataCell(SpreadsheetApp.Direction.UP).getRow()\n//   var WW\u003dHAct.getRange(\u0027T\u0027+Ult).getNextDataCell(SpreadsheetApp.Direction.UP).getRow()\n//   var Ind\u003d2\n//   var FF\u003dUU-1\n \n//  /////// Hora Fin////////\n//   if(HAct.getRange(\u0027T\u0027+Ind).isBlank()){}\n//   else {Ind\u003dHAct.getRange(\u0027T1\u0027).getNextDataCell(SpreadsheetApp.Direction.DOWN).getRow()+1}\n//   Logger.log(Ind)\n//   while(Ind\u003cWW)\n//   { Logger.log(Ind)\n//   if(HAct.getRange(\u0027T2\u0027).isBlank()){HAct.moveRows(HAct.getRange(\u00272:2\u0027),UU)}\n//   else {Ind\u003dHAct.getRange(\u0027T1\u0027).getNextDataCell(SpreadsheetApp.Direction.DOWN).getRow()+1\n//   HAct.moveRows(HAct.getRange(Ind+\u0027:\u0027+Ind),UU)}\n//   HAct.getRange(FF+\u0027:\u0027+FF).setBackground(\u0027#f4cccc\u0027);\n//   WW\u003dHAct.getRange(\u0027T\u0027+Ult).getNextDataCell(SpreadsheetApp.Direction.UP).getRow()\n//   Logger.log(\u0027WW\u003d\u0027+WW)\n//  }\n\n//  //////// Hora Inicio///////////\n//  Ind\u003d2\n//   if(HAct.getRange(\u0027O\u0027+Ind).isBlank()){HAct.moveRows(HAct.getRange(\u00272:2\u0027),UU)}\n//   else {Ind\u003dHAct.getRange(\u0027O1\u0027).getNextDataCell(SpreadsheetApp.Direction.DOWN).getRow()}\n//   VV\u003dHAct.getRange(\u0027O\u0027+Ult).getNextDataCell(SpreadsheetApp.Direction.UP).getRow()\n//  while(Ind\u003cVV)\n//  {HAct.moveRows(HAct.getRange(VV+\u0027:\u0027+VV),Ind+1)\n//   VV\u003dHAct.getRange(\u0027O\u0027+Ult).getNextDataCell(SpreadsheetApp.Direction.UP).getRow()\n//   Ind\u003dHAct.getRange(\u0027O1\u0027).getNextDataCell(SpreadsheetApp.Direction.DOWN).getRow()\n//   Logger.log(\u0027VV\u003d\u0027+VV)\n//  }\n\n// // HAct.getRange(\u00272:\u0027+WW).sort([{column:3,ascending:true},{column:15,ascending:true}])\n    \n//}\n\n\n\n// function BORRA_PROTECT_TODO()\n// {var ss \u003d SpreadsheetApp.getActive();\n//  var protections \u003d ss.getProtections(SpreadsheetApp.ProtectionType.RANGE);\n//  Logger.log(protections.length)\n// for (var i \u003d 0; i \u003c protections.length; i++) {\n//   var protection \u003d protections[i];\n//   Logger.log(protection)\n//   if (protection.canEdit()) {\n//     protection.remove();\n//   }\n//  }\n// }\n\n\n// function BORRA_PROTECT_FILA()\n// {var ss \u003d SpreadsheetApp.getActive();\n//  var Fila\u003dBrowser.inputBox(\u0027  Fila\u0027, \"\", Browser.Buttons.OK_CANCEL);\n//  var protections \u003d ss.getProtections(SpreadsheetApp.ProtectionType.RANGE);\n//  Logger.log(protections.length)\n// for (var i \u003d 0; i \u003c protections.length; i++) {\n//   var protection \u003d protections[i];\n//   var FF\u003dprotection.getRange().getA1Notation().indexOf(Fila,0)\n//   if(FF\u003e-1)\n//   { if (protection.canEdit()) {\n//     protection.remove();\n//      }\n//   }\n// }\n\n// }\n\n\n\n"},{"id":"b0417feb-a8f5-40b6-a4cf-9ad95be33a09","name":"macros","type":"server_js","source":"function ORDENAR_() {\n  var spreadsheet \u003d SpreadsheetApp.getActive();\r\n  var sheet \u003d spreadsheet.getActiveSheet();\r\n  sheet.getRange(1, 1, sheet.getMaxRows(), sheet.getMaxColumns()).activate();\r\n  spreadsheet.getActiveRange().offset(1, 0, spreadsheet.getActiveRange().getNumRows() - 1).sort({column: 15, ascending: true});\r\n  spreadsheet.getRange(\u0027O2\u0027).activate();\r\n  spreadsheet.getCurrentCell().getNextDataCell(SpreadsheetApp.Direction.DOWN).activate();\r\n  spreadsheet.getRange(\u0027O1\u0027).activate();\r\n  spreadsheet.getCurrentCell().getNextDataCell(SpreadsheetApp.Direction.DOWN).activate();\r\n  spreadsheet.getRange(\u00274180:4180\u0027).activate();\r\n  spreadsheet.setCurrentCell(spreadsheet.getRange(\u0027E4180\u0027));\r\n  var currentCell \u003d spreadsheet.getCurrentCell();\r\n  spreadsheet.getSelection().getNextDataRange(SpreadsheetApp.Direction.UP).activate();\r\n  currentCell.activateAsCurrentCell();\r\n  spreadsheet.getActiveRange().offset(1, 0, spreadsheet.getActiveRange().getNumRows() - 1).sort({column: 1, ascending: true});\r\n};"}]}