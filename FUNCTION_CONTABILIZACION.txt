{"files":[{"id":"e6eb24b9-31b2-498a-964d-74bcf92f73e2","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"America/New_York\",\n  \"dependencies\": {\n  },\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"sheets\": {\n    \"macros\": [{\n      \"menuName\": \"RTRTRT\",\n      \"functionName\": \"RTRTRT\"\n    }, {\n      \"menuName\": \"FGDF\",\n      \"functionName\": \"FGDF\"\n    }, {\n      \"menuName\": \"sdsd\",\n      \"functionName\": \"sdsd\"\n    }]\n  }\n}"},{"id":"0b8e0d98-fe4e-46da-b801-20d0a90bba99","name":"macros","type":"server_js","source":"function LMMJVSD(Fecha)\n{var Mod\u003dFecha%7;\n\nif(Mod\u003d\u003d0){return \"D\"}\nif(Mod\u003d\u003d1){return \"L\"}\nif(Mod\u003d\u003d2){return \"Ma\"}\nif(Mod\u003d\u003d3){return \"Mi\"}\nif(Mod\u003d\u003d4){return \"J\"}\nif(Mod\u003d\u003d5){return \"V\"}\nif(Mod\u003d\u003d6){return \"S\"}\n}\n\n\nfunction BASE_BASE()\n{ var H_A\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027Actividades\u0027)\n  var C\u003dH_A.getRange(\u0027O1\u0027).getValue()\n\n  if(C\u003d\u003d0)\n  {  var BASE\u003dSpreadsheetApp.openById(\"10QRzVRI76VWlRI8xKckjBympPjER-dejv-uwS8YsU5Q\").getSheetByName(\u0027BASE ACTIVIDADES\u0027)\n     var D_BASE\u003dBASE.getDataRange().getValues()\n     var U_B\u003dBASE.getDataRange().getLastRow()\n\n     H_A.getRange(\u0027A2:K\u0027+U_B).setValues(D_BASE.filter(function (v,i){return i\u003e0}).map(function (v){return [v[0],v[1],v[2],v[3],v[4],v[5],v[6],v[7],v[8],v[9],v[16]]}))\n\n  }\n\n  Logger.log(C)\n\n}\n\n\nfunction DIFF_ESP()\n{ var H_A\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027Actividades\u0027)\n  var C\u003dH_A.getRange(\u0027O1\u0027).getValue()\n\n  if(C\u003e0)\n  { var D_A\u003dH_A.getDataRange().getValues()\n    var TABLA\u003dSpreadsheetApp.openById(\"1Jx4_59606Rajbdxx11rjRu9xmbKEPGOV63ASs93Un5s\").getSheetByName(\u0027FIJAS\u0027)\n    //var TABLA\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027FIJAS\u0027)\n    var D_TABLA\u003dTABLA.getDataRange().getValues()\n     \n    \n  var Camb\u003dD_A.map(function (v,i){return [v[2],v[0],v[9],v[10],v[14],i+1]}).filter(function (v){return v[4]\u003d\u003d\u003d\"CAMBIO\"})\n  var L\u003dCamb.length\n\n    if(L\u003e0)\n    { var Cost\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027COSTO\u0027)\n      var D_Cost\u003dCost.getRange(\u0027A2:B\u0027).getValues()\n           \n    for(i\u003d0;i\u003cL;i++)\n    { var Index\u003dCamb[i][5]\n      var Fecha\u003dCamb[i][1]\n\n      var HI\u003d(Camb[i][2].valueOf()+2209143824000)/86400000 //\u003c-------\n      var HF\u003d(Camb[i][3].valueOf()+2209143824000)/86400000  //\u003c-------}\n\n      var Tec\u003dCamb[i][0]\n      var CC\u003dD_Cost.filter(function (v){return v[0]\u003d\u003d\u003dTec})\n      var Sueldo\u003dCC[0][1]\n         \n      var Mes\u003dnew Date(Fecha).getMonth()+1\n      var DS\u003dnew Date(Fecha).getDay()\n      var H_Mes\u003dCost.getRange(Mes+1,9).getValue()\n      var H_Tec\u003dSueldo/H_Mes\n        \n     if(Mes\u003c9)\n     { var Dur\u003d(HF-HI)*24\n       var CostAct\u003dDur*H_Tec\n       H_A.getRange(\u0027P\u0027+Index+\u0027:R\u0027+Index).setValues([[Dur,CostAct,Mes]])\n       H_A.getRange(\u0027L\u0027+Index+\u0027:N\u0027+Index).setValues([[Fecha,Camb[i][2],Camb[i][3]]])\n\n     } \n\n     else\n     { var B_Tab\u003dD_TABLA.map(function (v,i){return [v[0],v[2].valueOf(),v[6].valueOf(),v[10].valueOf(),v[14].valueOf(),v[18].valueOf(),i]}).filter(function (v){return v[0]\u003d\u003d\u003dTec})\n       var I_T\u003dB_Tab[0][6]\n\n       var Check_Break\u003dD_TABLA[I_T][21]\n       var Check_Pausas\u003dD_TABLA[I_T][22]\n       var Form\u003d(4*DS)-1\n       var Check_Lunch\u003dD_TABLA[I_T][Form]\n       var H_Lunch\u003d(B_Tab[0][DS]+2209143824000)/86400000\n    \n       var TIME\u003d[,,,,,]\n       if(Check_Break\u003d\u003d\u003dtrue){TIME[0]\u003d(9.5/24);TIME[1]\u003d(9.75/24)}else{TIME[0]\u003d0;TIME[1]\u003d0}\n       if(Check_Lunch\u003d\u003d\u003dtrue){TIME[2]\u003dH_Lunch;TIME[3]\u003d(H_Lunch+(0.5/24))}else{TIME[2]\u003dH_Lunch;TIME[3]\u003d(H_Lunch+(1/24))}\n       if(Check_Pausas\u003d\u003d\u003dtrue){TIME[4]\u003d(15/24);TIME[5]\u003d(15.25/24)}else{TIME[4]\u003d0;TIME[5]\u003d0}\n      Logger.log(HI+\u0027,\u0027+HF)\n      Logger.log(TIME)\n\n       var Dur\u003d(HF-HI)*24\n       Logger.log(Dur)\n       //////////DENTRO///////\n       if((HI\u003c\u003dTIME[0])\u0026\u0026(TIME[1]\u003c\u003dHF)){Dur\u003dDur-(0.25)}\n       if((HI\u003c\u003dTIME[2])\u0026\u0026(TIME[3]\u003c\u003dHF)){Dur\u003dDur-((TIME[3]-TIME[2])*24)}\n       if((HI\u003c\u003dTIME[4])\u0026\u0026(TIME[5]\u003c\u003dHF)){Dur\u003dDur-(0.25)}\n       ////////INTERSECTO HI///////////\n       if((HI\u003eTIME[0])\u0026\u0026(HI\u003cTIME[1])\u0026\u0026(HF\u003eTIME[1])){Dur\u003dDur-((TIME[1]-HI)*24)}\n       if((HI\u003eTIME[2])\u0026\u0026(HI\u003cTIME[3])\u0026\u0026(HF\u003eTIME[3])){Dur\u003dDur-((TIME[3]-HI)*24)}\n       if((HI\u003eTIME[4])\u0026\u0026(HI\u003cTIME[5])\u0026\u0026(HF\u003eTIME[5])){Dur\u003dDur-((TIME[5]-HI)*24)}\n      ////////INTERSECTO HF///////////\n       if((HF\u003eTIME[0])\u0026\u0026(HF\u003cTIME[1])\u0026\u0026(HI\u003cTIME[0])){Dur\u003dDur-((HF-TIME[0])*24)}\n       if((HF\u003eTIME[2])\u0026\u0026(HF\u003cTIME[3])\u0026\u0026(HI\u003cTIME[2])){Dur\u003dDur-((HF-TIME[2])*24)}\n       if((HF\u003eTIME[4])\u0026\u0026(HF\u003cTIME[5])\u0026\u0026(HI\u003cTIME[4])){Dur\u003dDur-((HF-TIME[4])*24)}\n       var CostAct\u003dDur*H_Tec\n\n       Logger.log(Dur)\n\n       H_A.getRange(\u0027P\u0027+Index+\u0027:R\u0027+Index).setValues([[Dur,CostAct,Mes]])\n       H_A.getRange(\u0027L\u0027+Index+\u0027:N\u0027+Index).setValues([[Fecha,Camb[i][2],Camb[i][3]]])     \n      \n    }\n   }\n  }\n }\n}\n\nfunction VERIF()\n{var H_A\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027Actividades\u0027)\n var D_HA\u003dH_A.getDataRange().getValues()\n var DB\u003dSpreadsheetApp.openById(\"10QRzVRI76VWlRI8xKckjBympPjER-dejv-uwS8YsU5Q\").getSheetByName(\u0027BASE ACTIVIDADES\u0027)\n\n var Filtro\u003dD_HA.map(function (v,i){return [v[0],(v[9].valueOf()+2209143712000)/86400000,(v[10].valueOf()+2209143712000)/86400000,i+1]}).filter(function (v){return v[3]\u003e1\u0026\u0026((v[1]\u003c1\u0026\u0026v[1]\u003e0)||(v[2]\u003c1\u0026\u0026v[2]\u003e0))})\n\n Logger.log(Filtro)\n\n for(i\u003d0;i\u003cFiltro.length;i++)\n { var Fecha\u003d(Filtro[i][0].valueOf()+2209143712000)/86400000\n   var Index\u003d Filtro[i][3]\n\n//+2209143824000)/86400000     2209143600000  2209143712000\n   var HI\u003dFiltro[i][1]\n   var HF\u003dFiltro[i][2]\n   if(HI\u003c1)\n   {var HI\u003dHI+Fecha\n    H_A.getRange(\u0027J\u0027+Index).setValue(HI)\n    DB.getRange(\u0027J\u0027+Index).setValue(HI)\n   }\n   if(HF\u003c1)\n   {var HF\u003dHF+Fecha\n   H_A.getRange(\u0027K\u0027+Index).setValue(HF)\n   DB.getRange(\u0027Q\u0027+Index).setValue(HF)\n   }\n }\n \n var Filtro2\u003dD_HA.map(function (v,i){return [v[0],(v[9].valueOf()+2209143600000)/86400000,(v[10].valueOf()+2209143600000)/86400000,i+1]}).filter(function (v){return v[3]\u003e1\u0026\u0026(v[2]-v[1])\u003e1})\n\n Logger.log(Filtro2)\n\n //Logger.log(Filtro2) //2209143749334  2209143488000  2209143655500 2209143600000\n\n for(j\u003d0;j\u003cFiltro2.length;j++)\n { var Fecha\u003d(Filtro2[j][0].valueOf()+2209143600000)/86400000\n   var Index\u003d Filtro2[j][3]\n\n   var HI\u003dFiltro2[j][1]\n   var HF\u003dFiltro2[j][2]\n   var NI\u003dHI-Fecha\n   var NF\u003dHF-Fecha\n\n   Logger.log(NI)\n   Logger.log(NF)\n    if((NI\u003e1)||(NI\u003c0))\n    {var HI\u003dHI-Math.trunc(HI)+Fecha\n     H_A.getRange(\u0027J\u0027+Index).setValue(HI)\n     DB.getRange(\u0027J\u0027+Index).setValue(HI)\n    }\n    if((NF\u003e1)||(NF\u003c0))\n    {var HF\u003dHF-Math.trunc(HF)+Fecha\n     H_A.getRange(\u0027K\u0027+Index).setValue(HF)\n     DB.getRange(\u0027Q\u0027+Index).setValue(HF)\n    }\n  }\n}\n\n\n\n"}]}