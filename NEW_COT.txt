{"files":[{"id":"c701e097-8851-4771-a2e0-fb2d239b6e81","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"America/Bogota\",\n  \"dependencies\": {\n  },\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\"\n}"},{"id":"1a6a8774-3149-49e2-be7d-898bfea9204b","name":"Código","type":"server_js","source":"function onEdit(e) {\n  if (e.source.getActiveSheet().getName() \u003d\u003d \"FORMATO\"){\n    var V \u003d e.value\n  if((e.range.getColumn()\u003d\u003d4)\u0026\u0026(e.range.getRow()\u003d\u003d2))\n    { var E\u003dSpreadsheetApp.getActiveSpreadsheet().getRange(\u0027E2\u0027).getNextDataCell(SpreadsheetApp.Direction.DOWN).getRow()\n      if(V\u003d\u003d\u0027FALSE\u0027){SpreadsheetApp.getActiveSpreadsheet().getRange(\u0027D3:D100\u0027).uncheck()}\n      if(V\u003d\u003d\u0027TRUE\u0027){SpreadsheetApp.getActiveSpreadsheet().getRange(\u0027D3:D\u0027+E).check()}\n    }\n  }\n}\n\n\nfunction BASE_COT() {\n  \n  var BASE\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027BASE\u0027);\n  var EST\u003dBASE.getRange(\u0027D1\u0027).setValue(\"Ejecutando\")\n\n  var D_BASE\u003dBASE.getDataRange().getValues()\n  var Ult\u003dBASE.getDataRange().getLastRow()+1\n\n  var EST\u003dBASE.getRange(\u0027D1\u0027).setValue(\"Ejecutando.\")\n  var Ult_ST\u003dBASE.getRange(\u0027F1000\u0027).getNextDataCell(SpreadsheetApp.Direction.UP).getRow()\n  var EST\u003dBASE.getRange(\u0027D1\u0027).setValue(\"Ejecutando..\")\n  SpreadsheetApp.flush()\n\n    var H_ST\u003dSpreadsheetApp.openById(\"1CGx8qzzzq1k4kGK0tLT5A3qzgbThyyVB2uk7ayvbv0Q\").getSheetByName(\u0027GLOBAL\u0027)\n  var D_ST\u003dH_ST.getRange(\u0027A:AK\u0027).getValues()\n  \n  var Filtro\u003dD_ST.map(function (v,i){return [v[0],v[6],v[4],v[25],v[28],v[34],v[3],v[17],v[19],v[20],v[21],v[22],v[32],v[33],v[36],i+1]}).filter(function (v){return v[12]!\u003d\u003d\"\"\u0026\u0026v[14]\u003d\u003d\u003d\"\"\u0026\u0026v[1]!\u003d\u003d\"REDEBAN MULTICOLOR S.A.\"\u0026\u0026v[1]!\u003d\u003d\"BANCO AGRARIO\"\u0026\u0026v[1]!\u003d\u003d\"BANCO DAVIVIENDA\"})\n\n  var EST\u003dBASE.getRange(\u0027D1\u0027).setValue(\"Ejecutando...\")\n\n  var L\u003dFiltro.length\n\n  Logger.log(L)\n  var LL\u003dL+3\n  \n  BASE.getRange(\u0027A4:P\u0027+Ult).clearContent()\n\n  SpreadsheetApp.flush()\n\n  BASE.getRange(\u0027A4:P\u0027+LL).setValues(Filtro)\n\n  var EST\u003dBASE.getRange(\u0027D1\u0027).setValue(\"Finalizado\")\n}\n\nfunction COTIZADOR() {\n  \n  var GLOBAL\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027BASE\u0027);\n  var D_GLOBAL\u003dGLOBAL.getDataRange().getValues()\n  var COT\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027FORMATO\u0027);\n  var D_COT\u003dCOT.getRange(\u0027A1:L100\u0027).getValues()\n  \n  COT.getRange(\u0027F1\u0027).setValue(\"Ejecutando\")\n\n   var Filtro2\u003dD_COT.map(function (v,i){return [v[3],v[4],i+1]}).filter(function (v){return v[0]\u003d\u003d\u003dtrue\u0026\u0026v[2]\u003e2})\n\n\n  for(i\u003d0;i\u003cFiltro2.length;i++)  //for(i\u003d3;i\u003c\u003dUlt_ST;i++)\n  { var ST\u003dFiltro2[i][1]   //COT.getRange(\u0027E\u0027+i).getValue()\n    var Index\u003dFiltro2[i][2]\n    COT.getRange(\u0027F\u0027+Index+\u0027:AZ\u0027+Index).clearContent()\n    COT.getRange(\u0027A\u0027+Index+\u0027:AC\u0027+Index).clearContent()\n    var L\u003dST.toString().length \n  //COT.getRange(\u0027F1\u0027).setValue(\"Ejecutando...\")\n    if(L\u003e0)\n    {\n    var Filtro\u003dD_GLOBAL.map(function (v){return [v[3],v[4],v[5],true,v[6],v[7],v[8],v[9],v[10],v[11],v[12],v[13]]}).filter(function (v){return v[4]\u003d\u003d\u003dST})\n    \n     COT.getRange(\u0027A\u0027+Index+\u0027:L\u0027+Index).setValues(Filtro)\n    }\n  }\n  COT.getRange(\u0027F1\u0027).setValue(\"Finalizado\")\n}\n\nfunction RETURN() {\n  \n  var GLOBAL\u003dSpreadsheetApp.openById(\"1CGx8qzzzq1k4kGK0tLT5A3qzgbThyyVB2uk7ayvbv0Q\").getSheetByName(\u0027GLOBAL\u0027)\n  var D_GLOBAL\u003dGLOBAL.getDataRange().getValues()\n  var COT\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027FORMATO\u0027);\n  var D_COT\u003dCOT.getRange(\u0027A1:AZ100\u0027).getValues()\n  var VECT_ENC\u003dCOT.getRange(\u0027A2:AZ2\u0027).getValues()\n  var FECHA\u003dCOT.getRange(\u0027L1\u0027).getValue()\n  var ui \u003d SpreadsheetApp.getUi();\n\n  for(i\u003d0;i\u003c52;i++)\n  { var ENC\u003dVECT_ENC[0][i]\n    if(ENC\u003d\u003d\"HORA DE SERVICIO\"){ var CHS\u003di}\n    if(ENC\u003d\u003d\"VALOR TOTAL REPUESTOS\"){var CVR\u003di}\n    if(ENC\u003d\u003d\"TIPIFICACIÓN\"){var CTP\u003di}\n    if(ENC\u003d\u003d\"ESTADO ITEM A HOY\"){var CEH\u003di}\n  }\n\n    COT.getRange(\u0027J1\u0027).setValue(\"Ejecutando\")\n\n  var Filtro2\u003dD_COT.map(function (v,i){return [v[3],v[6],v[7],v[10],v[11],v[CHS],v[CVR],v[CTP],i+1,v[4],v[CEH]]}).filter(function (v){return v[0]\u003d\u003d\u003dtrue\u0026\u0026v[8]\u003e2})\n\n  for(j\u003d0;j\u003cFiltro2.length;j++)\n  { var Index\u003dFiltro2[j][8]\n    if(Filtro2[j][5].toString()!\u003d\"\")\n    { if(Filtro2[j][6].toString()!\u003d\"\"){\n      if(Filtro2[j][7]!\u003d\"\")\n      { if(Filtro2[j][10]!\u003d\"\"){\n        var ST\u003dFiltro2[j][9]\n        var Filtro\u003dD_GLOBAL.map(function (v,i){return [v[3],i+1]}).filter(function (v){return v[0]\u003d\u003d\u003dST})\n        var Index2\u003dFiltro[0][1]\n\n        GLOBAL.getRange(\u0027A\u0027+Index2).setValue(Filtro2[j][10])\n        GLOBAL.getRange(\u0027T\u0027+Index2+\u0027:U\u0027+Index2).setValues([[Filtro2[j][1],Filtro2[j][2]]])\n        GLOBAL.getRange(\u0027AG\u0027+Index2+\u0027:AH\u0027+Index2).setValues([[Filtro2[j][3],Filtro2[j][4]]])\n        GLOBAL.getRange(\u0027AJ\u0027+Index2+\u0027:AL\u0027+Index2).setValues([[Filtro2[j][7],FECHA,Filtro2[j][5]]])\n        GLOBAL.getRange(\u0027AN\u0027+Index2).setValue(Filtro2[j][6])\n\n      } \n       else{ui.alert(\u0027Alerta\u0027,\u0027Falta información en la columna ESTADO ITEM A HOY de la Fila \u0027+ Index,ui.ButtonSet.OK)}      \n      }\n      else{ui.alert(\u0027Alerta\u0027,\u0027Falta información en la columna TIPIFICACIÓN de la Fila \u0027+ Index,ui.ButtonSet.OK)}\n    } \n    else{ui.alert(\u0027Alerta\u0027,\u0027Falta información en la columna VALOR TOTAL REPUESTOS de la Fila \u0027+ Index,ui.ButtonSet.OK)}\n        }\n    else{ui.alert(\u0027Alerta\u0027,\u0027Falta información en la columna HORA DE SERVICIO de la Fila \u0027+ Index,ui.ButtonSet.OK)  }\n  }\n  COT.getRange(\u0027J1\u0027).setValue(\"Finalizado\")\n}\n\n\n"}]}