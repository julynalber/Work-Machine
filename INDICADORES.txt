{"files":[{"id":"de138a8a-0082-4a07-889c-4f7d4995338c","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"America/Bogota\",\n  \"dependencies\": {\n  },\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"sheets\": {\n    \"macros\": [{\n      \"menuName\": \"DB3\",\n      \"functionName\": \"DB3\"\n    }]\n  }\n}"},{"id":"822ab1d6-87af-42bf-891b-538179b47c1c","name":"Código","type":"server_js","source":"function DB3() \n{ var GLOBAL\u003dSpreadsheetApp.openById(\"14AazFE4VOZZoRE-DQt_YOIgbQaZLQEPt95cRZfO3KYk\").getSheetByName(\u0027GLOBAL\u0027)\n  var DB3\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027DB3\u0027)\n  var D_GLOBAL\u003dGLOBAL.getDataRange().getValues()\n  var D_DB3\u003dDB3.getDataRange().getValues()\n  \n  var Filtro\u003dD_GLOBAL.filter(function (v,i){return i\u003e2\u0026\u0026v[3]!\u003d\u003d\"\"})\n  var L\u003dFiltro.length\n  var F\u003dL+1\n\n  var DATA1\u003dFiltro.map(function (v){return [v[3],v[0],v[19],v[16],v[17],v[18],v[15],v[26],v[6],v[9],v[8],v[7],v[36]]})\n\n  DATA1.forEach(function (v,i,A){ if(v[12]\u003d\u003d\"\"){A[i][12]\u003d\"PENDIENTE\"}})\n\n  DB3.getRange(\u0027A2:M\u0027+F).setValues(DATA1)\n\n  var DATA2\u003dFiltro.map(function (v){return [,,v[41],v[55]]})\n\n  DATA2.forEach(function (v,i,A)\n  {if(v[3]\u003d\u003d\"\"){A[i][3]\u003d\"PENDIENTE\"}\n   if(v[2]!\u003d\"\"){var FEC\u003dnew Date(v[2])\n    var MM\u003dFEC.getMonth()\n    var YY\u003dFEC.getFullYear()\n    switch (MM) {\n    case 0: var FF\u003d\"ENERO\";break;\n    case 1: var FF\u003d\"FEBRERO\";break;\n    case 2: var FF\u003d\"MARZO\";break;\n    case 3: var FF\u003d\"ABRIL\";break;\n    case 4: var FF\u003d\"MAYO\";break;\n    case 5: var FF\u003d\"JUNIO\";break;\n    case 6: var FF\u003d\"JULIO\";break;\n    case 7: var FF\u003d\"AGOSTO\";break;\n    case 8: var FF\u003d\"SEPTIEMBRE\";break;\n    case 9: var FF\u003d\"OCTUBRE\";break;\n    case 10: var FF\u003d\"NOVIEMBRE\";break;\n    case 11: var FF\u003d\"DICIEMBRE\";break;\n    \n  }A[i][0]\u003dYY\n   A[i][1]\u003dFF    \n   }\n  if(v[2]\u003d\u003d\"\"){\n    A[i][0]\u003d\"PENDIENTE\"\n    A[i][1]\u003d\"PENDIENTE\"\n    A[i][2]\u003d\"PENDIENTE\"}\n  })\n\n  DB3.getRange(\u0027O2:R\u0027+F).setValues(DATA2)\n\n}\n\nfunction DB2() \n{ var GLOBAL\u003dSpreadsheetApp.openById(\"14AazFE4VOZZoRE-DQt_YOIgbQaZLQEPt95cRZfO3KYk\").getSheetByName(\u0027GLOBAL\u0027)\n  var DB2\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027DB2\u0027)\n  var CONTAB\u003dSpreadsheetApp.openById(\"17xJrUCg04Kiyp5xyXy0vpxYMFyuIyPDtJ2PZBBmLDr4\").getSheetByName(\u0027Actividades\u0027)\n  var CONTAB2\u003dSpreadsheetApp.openById(\"14jBONxjEVq4pdr_JDDE2yMn6KII0o65bHnLr0HKIJOQ\").getSheetByName(\u0027Actividades\u0027)\n  \n  var D_GLOBAL\u003dGLOBAL.getDataRange().getValues()\n  var D_CONTAB\u003dCONTAB.getDataRange().getValues()\n  var D_CONTAB2\u003dCONTAB.getDataRange().getValues()\n\n  var Filtro\u003dD_GLOBAL.map(function (v,i){return[v[0],v[3],v[6],v[7],v[8],v[9],v[15],v[16],v[17],v[19],v[21],v[29],v[31],v[32],v[33],v[48],v[51],,,,,,,,,v[34],i+1]}).filter(function (v){return v[25]\u003d\u003d\u003d\"SI APLICA\"\u0026\u0026v[5]\u003e2020})\n\n  for(i\u003d0;i\u003cFiltro.length;i++)\n  { var ST\u003d Filtro[i][1].toString()\n    var SS\u003dFiltro[i][9].toString()\n    var Index\u003dFiltro[i][26]\n    if(Filtro[i][3]!\u003d\"\"){Filtro[i][3]\u003dUtilities.formatDate(new Date(Filtro[i][3]),\"America/Bogota\",\"dd/MM/yyyy\")}\n    if(Filtro[i][12]!\u003d\"\"){Filtro[i][12]\u003dUtilities.formatDate(new Date(Filtro[i][12]),\"America/Bogota\",\"dd/MM/yyyy\")}\n    if(Filtro[i][16]!\u003d\"\"){Filtro[i][16]\u003dUtilities.formatDate(new Date(Filtro[i][12]),\"America/Bogota\",\"dd/MM/yyyy\")}\n    \n    var Filtro2\u003d D_GLOBAL.filter(function (v,i){return v[19]\u003d\u003d\u003dSS\u0026\u0026i\u003cIndex-1})\n    Logger.log(Filtro2)\n    if(Filtro2.length\u003e0)\n    { var LL\u003dFiltro2.length-1\n      Filtro[i][17]\u003dFiltro2[LL][3]\n      Filtro[i][18]\u003dFiltro2[LL][21]\n      Filtro[i][19]\u003dFiltro2[LL][32]\n      Filtro[i][20]\u003dFiltro2[LL][33]\n      Filtro[i][21]\u003dFiltro2[LL][48]\n      if((Filtro2[LL][51]!\u003d\"\")\u0026\u0026(Filtro2[LL][51]!\u003d\"N/A\")){Filtro[i][22]\u003dUtilities.formatDate(new Date(Filtro2[LL][51]),\"America/Bogota\",\"dd/MM/yyyy\")}\n\n      var Filtro3\u003dD_CONTAB.filter(function (v){return v[2]\u003d\u003d\u003dFiltro[i][11]\u0026\u0026v[4]\u003d\u003d\u003d\"Revisión\"\u0026\u0026v[7]\u003d\u003d\u003dFiltro[i][1]})\n      if(Filtro3.length\u003d\u003d1){ Filtro[i][23]\u003dFiltro3[0][13]}\n      if(Filtro3.length\u003e1)\n      { var acum\u003d0\n        var j\u003d0\n       while(j\u003cFiltro3.length)\n       {acum\u003dacum+Filtro3[j][13]\n        j\u003dj+1}\n      Filtro[i][23]\u003dacum\n      }if(Filtro3.length\u003d\u003d0)\n      {  var Filtro5\u003dD_CONTAB2.filter(function (v){return v[2]\u003d\u003d\u003dFiltro[i][11]\u0026\u0026v[4]\u003d\u003d\u003d\"Revisión\"\u0026\u0026v[7]\u003d\u003d\u003dFiltro[i][1]})\n      if(Filtro5.length\u003d\u003d1){ Filtro[i][23]\u003dFiltro5[0][16]}\n      if(Filtro5.length\u003e1)\n      { var acum\u003d0\n        var j\u003d0\n       while(j\u003cFiltro5.length)\n       {acum\u003dacum+Filtro5[j][16]\n        j\u003dj+1}\n      Filtro[i][23]\u003dacum\n      }\n      }\n\n      var Filtro4\u003dD_CONTAB.filter(function (v){return v[2]\u003d\u003d\u003dFiltro[i][11]\u0026\u0026v[4]\u003d\u003d\u003d\"Reparación\"\u0026\u0026v[7]\u003d\u003d\u003dFiltro[i][1]})\n      if(Filtro4.length\u003d\u003d1){ Filtro[i][24]\u003dFiltro4[0][13]}\n      if(Filtro4.length\u003e1)\n      { var acum\u003d0\n        var j\u003d0\n       while(j\u003cFiltro4.length)\n       {acum\u003dacum+Filtro4[j][13]\n        j\u003dj+1}\n      Filtro[i][24]\u003dacum\n      }if(Filtro4.length\u003d\u003d0)\n      {  var Filtro6\u003dD_CONTAB2.filter(function (v){return v[2]\u003d\u003d\u003dFiltro[i][11]\u0026\u0026v[4]\u003d\u003d\u003d\"Reparación\"\u0026\u0026v[7]\u003d\u003d\u003dFiltro[i][1]})\n      if(Filtro6.length\u003d\u003d1){ Filtro[i][24]\u003dFiltro6[0][16]}\n      if(Filtro6.length\u003e1)\n      { var acum\u003d0\n        var j\u003d0\n       while(j\u003cFiltro6.length)\n       {acum\u003dacum+Filtro6[j][16]\n        j\u003dj+1}\n      Filtro[i][23]\u003dacum\n      }\n      }\n\n\n\n    }\n  }\n\n  var L\u003dFiltro.length+1\n\n  var Data\u003dFiltro.map(function (v){return [v[0],v[1],v[2],v[3],v[4],v[5],v[6],v[7],v[8],v[9],v[10],v[11],v[12],v[13],v[14],v[15],v[16],v[17],v[18],v[19],v[20],v[21],v[22],v[23],v[24]]})\n\n  DB2.getRange(\u0027A2:Y\u0027+L).setValues(Data)\n\n  Logger.log(L)\n  \n}\n\n\n\n\n"}]}