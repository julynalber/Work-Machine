{"files":[{"id":"5d75838a-15e3-4e2d-bb0f-658a1df0d5ff","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"America/New_York\",\n  \"dependencies\": {\n    \"enabledAdvancedServices\": [\n      {\n        \"userSymbol\": \"Sheets\",\n        \"version\": \"v4\",\n        \"serviceId\": \"sheets\"\n      }\n    ]\n  },\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"sheets\": {\n    \"macros\": [\n      {\n        \"menuName\": \"CORREO\",\n        \"functionName\": \"CORREO\"\n      }\n    ]\n  }\n}"},{"id":"79441bea-b6c9-473a-976f-143ccd8ef404","name":"Código","type":"server_js","source":"function onEdit(e) {\n  if ((e.source.getActiveSheet().getName() !\u003d \"BASE\")||(e.source.getActiveSheet().getName() !\u003d \"FORM_BOG\")||(e.source.getActiveSheet().getName() !\u003d \"FORM_MED\")||(e.source.getActiveSheet().getName() !\u003d \"FORM_CALI\")) \n  {\n    var F \u003d e.range.getRow()\n    var C \u003d e.range.getColumn()\n    var V \u003d e.value\n    if ((C \u003d\u003d 6) \u0026\u0026 (F \u003d\u003d2)){SpreadsheetApp.getActiveSpreadsheet().getRange(\u0027F2\u0027).setBackground(\"white\")}\n    if ((C \u003d\u003d 6) \u0026\u0026 (F \u003d\u003d3)){SpreadsheetApp.getActiveSpreadsheet().getRange(\u0027F3\u0027).setBackground(\"white\")}\n    if ((C \u003d\u003d 6) \u0026\u0026 (F \u003d\u003d4)){SpreadsheetApp.getActiveSpreadsheet().getRange(\u0027F4\u0027).setBackground(\"white\")}\n    \n    if ((C \u003d\u003d 6) \u0026\u0026 (F \u003d\u003d3)\u0026\u0026((V \u003d\u003d \"CLIENTE RECOGE\")||(V \u003d\u003d \"MENSAJERO\")))\n    {\n      SpreadsheetApp.getActiveSpreadsheet().getRange(\u0027F4\u0027).setValue(\"N/A\").setBackground(\"white\")\n      return;\n    }\n    if ((C \u003d\u003d 6) \u0026\u0026 (F \u003d\u003d3)\u0026\u0026((V !\u003d \"CLIENTE RECOGE\")||(V !\u003d \"MENSAJERO\")))\n    {\n      SpreadsheetApp.getActiveSpreadsheet().getRange(\u0027F4\u0027).setValue(\"\")\n      return;\n    }\n    if((C\u003d\u003d1)\u0026\u0026(F\u003d\u003d6))\n    { var E\u003dSpreadsheetApp.getActiveSpreadsheet().getRange(\u0027F6\u0027).getNextDataCell(SpreadsheetApp.Direction.DOWN).getRow()\n      if(V\u003d\u003d\u0027FALSE\u0027){SpreadsheetApp.getActiveSpreadsheet().getRange(\u0027A7:A\u0027).uncheck()}\n      if(V\u003d\u003d\u0027TRUE\u0027){SpreadsheetApp.getActiveSpreadsheet().getRange(\u0027A7:A\u0027+E).check()}\n    }\n  }\n}\n\nfunction BASE() {\n  \n  var BASE\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027BASE\u0027);\n  var EST\u003dBASE.getRange(\u0027D1\u0027).setValue(\"Ejecutando\")\n\n  var D_BASE\u003dBASE.getDataRange().getValues()\n  var Ult\u003dBASE.getDataRange().getLastRow()+1\n\n  var EST\u003dBASE.getRange(\u0027D1\u0027).setValue(\"Ejecutando.\")\n  var Ult_ST\u003dBASE.getRange(\u0027D2000\u0027).getNextDataCell(SpreadsheetApp.Direction.UP).getRow()\n  var EST\u003dBASE.getRange(\u0027D1\u0027).setValue(\"Ejecutando..\")\n  SpreadsheetApp.flush()\n\n    var H_ST\u003dSpreadsheetApp.openById(\"14AazFE4VOZZoRE-DQt_YOIgbQaZLQEPt95cRZfO3KYk\").getSheetByName(\u0027GLOBAL\u0027)\n  var D_ST\u003dH_ST.getRange(\u0027A:BG\u0027).getValues().map(function (v,i){return [v[15],v[0],v[6],v[3],v[16],v[17],v[19].toString(),v[20],v[22],v[52].toString(),v[12],v[10],v[13],v[44],v[58],v[53],v[54],v[55],v[14],i+1]}).filter(function (v){return (v[1]\u003d\u003d\u003d\"LISTO PARA ENTREGA\"||v[1]\u003d\u003d\u003d\"DEVOLUCIÓN SIN REPARAR\")\u0026\u0026v[17]\u003d\u003d\u003d\"\"})\n\n  var EST\u003dBASE.getRange(\u0027D1\u0027).setValue(\"Ejecutando...\")\n\n  var L\u003dD_ST.length\n  var LL\u003dL+3\n\n  BASE.getRange(\u0027A4:T\u0027+Ult).clearContent()\n  SpreadsheetApp.flush()\n  BASE.getRange(\u0027A4:T\u0027+LL).setValues(D_ST)\n\n  var EST\u003dBASE.getRange(\u0027D1\u0027).setValue(\"Finalizado\")\n\n}\n\nfunction LISTA()\n{ var HOJA\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027REGISTRO\u0027)\n  var D_H\u003dHOJA.getDataRange().getValues()\n  var U_H\u003dHOJA.getDataRange().getLastRow()\n\n  HOJA.getRange(\u0027M1:M\u0027+U_H).setValue(\".\")\n\n  Logger.log(U_H)\n\n\n}\n\n  function REM_BOG()\n  { var HREM\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027BOGOTÁ\u0027)\n   var FORM\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027FORM_BOG\u0027)\n   var SEDE\u003d\"BOGOTÁ\"\n   var ENL \u003d \"https://docs.google.com/spreadsheets/d/1XpPS-gnMBoNuasvDdtXW38gXBDb0sp5im_L422rOr58/export?gid\u003d1968250466\u0026format\u003dpdf\u0026gridlines\u003dfalse\"\n   REM_(HREM,FORM,SEDE,ENL)\n  }\n  function REM_MED()\n  { var HREM\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027MEDELLÍN\u0027)\n   var FORM\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027FORM_MED\u0027)\n   var SEDE\u003d\"MEDELLÍN\"\n   var ENL \u003d \"https://docs.google.com/spreadsheets/d/1XpPS-gnMBoNuasvDdtXW38gXBDb0sp5im_L422rOr58/export?gid\u003d224996981\u0026format\u003dpdf\u0026gridlines\u003dfalse\"\n  REM_(HREM,FORM,SEDE,ENL)\n  }\n\n  function REM_CALI()\n  {var HREM\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027CALI\u0027)\n   var FORM\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027FORM_CALI\u0027)\n   var SEDE\u003d\"CALI\"\n   var ENL \u003d \"https://docs.google.com/spreadsheets/d/1XpPS-gnMBoNuasvDdtXW38gXBDb0sp5im_L422rOr58/export?gid\u003d7076466\u0026format\u003dpdf\u0026gridlines\u003dfalse\"\n   REM_(HREM,FORM,SEDE,ENL)\n  }\n  function REM_RED()\n  {var HREM\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027REDEBAN\u0027)\n   var FORM\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027FORM_RED\u0027)\n   var SEDE\u003d\"BOGOTÁ\"\n   var ENL \u003d \"https://docs.google.com/spreadsheets/d/1XpPS-gnMBoNuasvDdtXW38gXBDb0sp5im_L422rOr58/export?gid\u003d1024182894\u0026format\u003dpdf\u0026gridlines\u003dfalse\"\n   REM_(HREM,FORM,SEDE,ENL)\n  }\n\nfunction REM_(HREM,FORM,SEDE,ENL)\n{  \n   var REG\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027REGISTRO\u0027)\n   var D_REM\u003dHREM.getDataRange().getValues()\n   var RR\u003dnew RegExp(\"[A-Za-z0-9._\\-]*@[A-Za-z0-9._\\-]*\",\"g\")\n   var ui \u003d SpreadsheetApp.getUi();\n\n   var FF\u003dD_REM[1][5]\n   var FFF\u003dFF.toLocaleString().slice(0,FF.toLocaleString().indexOf(\u0027,\u0027,0))\n   var TT\u003dD_REM[2][5].toString()\n   var GG\u003dD_REM[3][5].toString()\n  \n   if((FF!\u003d\"\")\u0026\u0026(TT!\u003d\"\")\u0026\u0026(GG!\u003d\"\"))\n  { var DIA\u003dnew Date()\n    var DI\u003dFF.valueOf()/86400000\n    var DA\u003d(DIA.valueOf()/86400000) -1\n \n    if(DI\u003cDA)\n   {var R0\u003dui.alert(\u0027Alerta\u0027,\u0027La fecha a imprimir es menor al día actual. ¿Desea continuar?\u0027,ui.ButtonSet.YES_NO)}\n   else{var R0\u003d\"YES\"}\n    \n    if(R0\u003d\u003d\"YES\")\n    {    \n    var L\u003dHREM.getRange(\u0027F1000\u0027).getNextDataCell(SpreadsheetApp.Direction.UP).getRow()-6    \n    var CLIENTE\u003dD_REM[6][4]\n    var F1\u003dD_REM.filter(function (v,i){return v[4]\u003d\u003d\u003dCLIENTE}).length\n    if(F1\u003d\u003dL)\n    { var CITY\u003dD_REM[6][13]\n      var DIR\u003dD_REM[6][12]\n      var CONT\u003dD_REM[6][14]\n      var MAIL\u003dD_REM[6][20]\n      var F2\u003dD_REM.filter(function (v,i){return v[13]\u003d\u003d\u003dCITY}).length\n      var F3\u003dD_REM.filter(function (v,i){return v[12]\u003d\u003d\u003dDIR}).length\n      var F4\u003dD_REM.filter(function (v,i){return v[14]\u003d\u003d\u003dCONT}).length\n      if((F2\u003d\u003dL)\u0026\u0026(F3\u003d\u003dL)\u0026\u0026(F4\u003d\u003dL))\n      { var D_SEL\u003dD_REM.filter(function (v,i){return v[0]\u003d\u003d\u003dtrue\u0026\u0026i\u003e5\u0026\u0026v[5]!\u003d\u003d\"\"})\n        var LL\u003dD_SEL.length\n        if(LL\u003cL)\n        { var R1\u003dui.alert(\u0027Alerta\u0027,\u0027La cantidad de servicios seleccionados es inferior a los servicios disponibles. ¿Desea continuar?\u0027,ui.ButtonSet.YES_NO)}else{var R1\u003d\"YES\"}\n       \n        if(R1\u003d\u003d\"YES\")\n        {\n        var F5\u003dD_SEL.filter(function (v){return v[11]!\u003d\u003d\"\"}).length\n        if(F5\u003d\u003dLL)\n        { var UF\u003dFORM.getLastRow()\n          if(UF\u003e35){var DF\u003dUF-35\n          FORM.deleteRows(13,DF)}\n          FORM.getRange(\u0027D2:D10\u0027).clearContent()\n          FORM.getRange(\u0027B13:I27\u0027).clearContent()\n\n          var USER\u003dSession.getActiveUser().getEmail()\n\n          F6\u003dD_SEL.filter(function(v){return v[15]!\u003d\u003d\"\"}).length\n          F7\u003dD_SEL.filter(function(v){return v[16]!\u003d\u003d\"\"}).length\n          FORM.getRange(\u0027D2\u0027).setValue(CLIENTE)\n          FORM.getRange(\u0027D4\u0027).setValue(DIR)\n          FORM.getRange(\u0027D5\u0027).setValue(CITY)\n          FORM.getRange(\u0027D6\u0027).setValue(CONT)\n          FORM.getRange(\u0027D7\u0027).setValue(FF)\n          if(F6\u003d\u003d0){FORM.getRange(\u0027D8\u0027).setValue(\"N/A\")}else{FORM.getRange(\u0027D8\u0027).setValue(D_SEL[0][15])}\n          if(F7\u003d\u003d0){FORM.getRange(\u0027D9\u0027).setValue(\"N/A\")}else{FORM.getRange(\u0027D9\u0027).setValue(D_SEL[0][16])}\n\n          if(LL\u003e11){FORM.insertRowsAfter(15,LL-10)}\n          var REM\u003dD_SEL.map(function (v){return [v[5],v[6],v[7],v[8],v[9],v[10],v[11]]})\n          var NUM\u003dD_SEL.map(function (v){return [v[1]]})\n          NUM.forEach(function (v,i,A){A[i][0]\u003di+1})\n          FORM.getRange(13,2,LL,1).setValues(NUM)\n          FORM.getRange(13,3,LL,7).setValues(REM)\n          SpreadsheetApp.flush()\n\n          var Serv\u003dD_SEL.map(function (v){return [v[5]]}).join(\u0027 \u0027)\n          var QR\u003dDIA.toLocaleString(\u0027es-CO\u0027,{ timeZone: \"America/Bogota\" })\n          var URL\u003d\"https://chart.googleapis.com/chart?chs\u003d100x100\u0026cht\u003dqr\u0026chl\u003d\"+encodeURI(QR)\n          FORM.getRange(\u0027I1\u0027).setFormula(\u0027\u003dIMAGE(\"\u0027+URL+\u0027\")\u0027)\n\n          if((TT\u003d\u003d\"CLIENTE RECOGE\")||(TT\u003d\u003d\"MENSAJERO\"))\n          {FORM.getRange(\u0027D10\u0027).setValue(TT)\n          var templ \u003d HtmlService.createTemplateFromFile(\u0027Bbody2\u0027);\n           var k\u003d0;\n              var MM\u003d\"\"\n              var Ind\u003dMAIL.toString().indexOf(\u0027@\u0027,0)\n              while(Ind!\u003d-1){ Ind\u003dMAIL.toString().indexOf(\u0027@\u0027,Ind+1)\n               k\u003dk+1}   \n             for(j\u003d0;j\u003ck;j++)\n              { if(MM\u003d\u003d\"\"){MM\u003dRR.exec(MAIL)} else{MM\u003dMM+\u0027,\u0027+RR.exec(MAIL)}\n              } RR.exec(MAIL)\n           }\n          else{FORM.getRange(\u0027D10\u0027).setValue(GG+\u0027 - \u0027+TT)\n               var templ \u003d HtmlService.createTemplateFromFile(\u0027Bbody\u0027);\n              var k\u003d0;\n              var MM\u003d\"\"\n              var Ind\u003dMAIL.toString().indexOf(\u0027@\u0027,0)\n              while(Ind!\u003d-1){ Ind\u003dMAIL.toString().indexOf(\u0027@\u0027,Ind+1)\n               k\u003dk+1}   \n             for(j\u003d0;j\u003ck;j++)\n              { if(MM\u003d\u003d\"\"){MM\u003dRR.exec(MAIL)} else{MM\u003dMM+\u0027,\u0027+RR.exec(MAIL)}\n              } RR.exec(MAIL)\n             }SpreadsheetApp.flush()\n\n     //     var ENL \u003d \"https://docs.google.com/spreadsheets/d/1XpPS-gnMBoNuasvDdtXW38gXBDb0sp5im_L422rOr58/export?gid\u003d1968250466\u0026format\u003dpdf\u0026gridlines\u003dfalse\"\n \n           var parametros \u003d {muteHttpExceptions: true,headers: {Authorization: \u0027Bearer \u0027 + ScriptApp.getOAuthToken(),}}\n\n  var respuesta\u003dUrlFetchApp.fetch(ENL, parametros)\n  var blob\u003drespuesta.getAs(\"application/pdf\")\n  \n  templ.Cliente \u003d CLIENTE\n  templ.Guia\u003d GG\n  templ.Transportadora\u003dTT\n  templ.Servicios\u003d Serv\n  \n  var message \u003d templ.evaluate().getContent();\n\nGmailApp.sendEmail(MM,CLIENTE+\u0027 - ENTREGA DE DISPOSITIVOS\u0027,\u0027\u0027,\n  {htmlBody: message,\n   cc: \"atencioncliente@wi-mobile.com\",\n   replyTo: \"atencioncliente@wi-mobile.com\",\n   attachments: [blob.setName(CLIENTE+\u0027 - \u0027+FFF+\u0027 - \u0027+Serv)]})\n           var H_ST\u003dSpreadsheetApp.openById(\"1CGx8qzzzq1k4kGK0tLT5A3qzgbThyyVB2uk7ayvbv0Q\").getSheetByName(\u0027GLOBAL\u0027)\n            var DATA\u003d[TT,GG,FF]\n            var II\u003dD_SEL.map(function (v){return [v[21]]})\n            for(l\u003d0;l\u003cLL;l++){ var UU\u003dII[l][0]\n              H_ST.getRange(\u0027BB\u0027+UU+\u0027:BD\u0027+UU).setValues([DATA])\n              H_ST.getRange(\u0027A\u0027+UU).setValue(\"ENTREGADO\")\n              }\n        var U_R\u003dREG.getLastRow()+1\n        REG.getRange(U_R,1,LL,1).setValue(QR)\n        REG.getRange(U_R,2,LL,1).setValue(USER)\n        REG.getRange(U_R,3,LL,1).setValue(FFF)\n        REG.getRange(U_R,4,LL,1).setValue(SEDE)\n        REG.getRange(U_R,5,LL,1).setValue(CLIENTE)\n        REG.getRange(U_R,6,LL,7).setValues(REM)\n        HREM.getRange(\u0027F3:F4\u0027).clearContent()\n        \n        }\n        else{ui.alert(\u0027Alerta\u0027,\u0027Falta información casilla del sello (DEVOL ó # SELLO)\u0027,ui.ButtonSet.OK)}\n       }\n      }\n      else \n      {var R2\u003dui.alert(\u0027Alerta\u0027,\u0027Se encuentran varias Direcciones o Contactos para remisionar. ¿Desea continuar?\u0027,ui.ButtonSet.YES_NO)\n       if(R2\u003d\u003d\"YES\")\n       { var Array1\u003d[...new Set(D_REM.map(function(v){return v[12]}).filter(function(v,i){return i\u003e5}))]\n         Array1.splice(-1,1)\n         var L1\u003dArray1.length\n         if(L1\u003e1){\n         var CC1\u003d\"\"\n         for(i\u003d0;i\u003cL1;i++)\n         { var j\u003di+1\n           var DD\u003dD_REM.map(function (v){return [v[12],v[13]]}).filter(function (v){return v[0]\u003d\u003d\u003dArray1[i]})\n           CC1\u003dCC1+j+\u0027. \u0027+Array1[i]+\u0027, \u0027+DD[0][1]+\u0027\\n\u0027\n         }\n         var N1\u003dui.prompt(\u0027Escribir el # que representa la dirección\\n\u0027+CC1, ui.ButtonSet.OK)\n         if((N1.getResponseText()\u003e0)\u0026\u0026(N1.getResponseText()\u003c\u003dL1))\n         {DIR\u003dArray1[N1.getResponseText()-1]\n          DD\u003dD_REM.map(function (v){return [v[12],v[13]]}).filter(function (v){return v[0]\u003d\u003d\u003dDIR})\n          CITY\u003dDD[0][1]\n          \n         }\n         else{var A1\u003dui.alert(\u0027Alerta\u0027,\u0027El número ingresado no es válido\u0027,ui.ButtonSet.OK)}\n         }\n\n         var Array2\u003d[...new Set(D_REM.map(function(v){return v[14]}).filter(function(v,i){return i\u003e5}))]\n         Array2.splice(-1,1)\n         var L2\u003dArray2.length\n         if((L2\u003e1)\u0026\u0026(A1!\u003d\"OK\")){\n         var CC2\u003d\"\"\n         for(i\u003d0;i\u003cL2;i++)\n         { var j\u003di+1\n           CC2\u003dCC2+j+\u0027. \u0027+Array2[i]+\u0027\\n\u0027\n         }\n         var N2\u003dui.prompt(\u0027Escribir el # que representa el Contacto\\n\u0027+CC2, ui.ButtonSet.OK)\n         if((N2.getResponseText()\u003e0)\u0026\u0026(N2.getResponseText()\u003c\u003dL2)){CONT\u003dArray2[N2.getResponseText()-1]\n         EE\u003dD_REM.map(function (v){return [v[14],v[20]]}).filter(function (v){return v[0]\u003d\u003d\u003dCONT})\n         MAIL\u003dEE[0][1]\n         }\n         else{var A2\u003dui.alert(\u0027Alerta\u0027,\u0027El número ingresado no es válido\u0027,ui.ButtonSet.OK)}\n         }\n         if((A1!\u003d\"OK\")\u0026\u0026(A2!\u003d\"OK\"))\n         { var D_SEL\u003dD_REM.filter(function (v,i){return v[0]\u003d\u003d\u003dtrue\u0026\u0026i\u003e5\u0026\u0026v[5]!\u003d\u003d\"\"})\n        var LL\u003dD_SEL.length\n        if(LL\u003cL)\n        { var R1\u003dui.alert(\u0027Alerta\u0027,\u0027La cantidad de servicios seleccionados es inferior a los servicios disponibles. ¿Desea continuar?\u0027,ui.ButtonSet.YES_NO)}else{var R1\u003d\"YES\"}\n       \n        if(R1\u003d\u003d\"YES\")\n        {\n        var F5\u003dD_SEL.filter(function (v){return v[11]!\u003d\u003d\"\"}).length\n        if(F5\u003d\u003dLL)\n        { var UF\u003dFORM.getLastRow()\n          if(UF\u003e35){var DF\u003dUF-35\n          FORM.deleteRows(13,DF)}\n          FORM.getRange(\u0027D2:D10\u0027).clearContent()\n          FORM.getRange(\u0027B13:I27\u0027).clearContent()\n\n          var USER\u003dSession.getActiveUser().getEmail()\n\n          F6\u003dD_SEL.filter(function(v){return v[15]!\u003d\u003d\"\"}).length\n          F7\u003dD_SEL.filter(function(v){return v[16]!\u003d\u003d\"\"}).length\n          FORM.getRange(\u0027D2\u0027).setValue(CLIENTE)\n          FORM.getRange(\u0027D4\u0027).setValue(DIR)\n          FORM.getRange(\u0027D5\u0027).setValue(CITY)\n          FORM.getRange(\u0027D6\u0027).setValue(CONT)\n          FORM.getRange(\u0027D7\u0027).setValue(FF)\n          if(F6\u003d\u003d0){FORM.getRange(\u0027D8\u0027).setValue(\"N/A\")}else{FORM.getRange(\u0027D8\u0027).setValue(D_SEL[0][15])}\n          if(F7\u003d\u003d0){FORM.getRange(\u0027D9\u0027).setValue(\"N/A\")}else{FORM.getRange(\u0027D9\u0027).setValue(D_SEL[0][16])}\n\n          if(LL\u003e11){FORM.insertRowsAfter(15,LL-10)}\n          var REM\u003dD_SEL.map(function (v){return [v[5],v[6],v[7],v[8],v[9],v[10],v[11]]})\n          var NUM\u003dD_SEL.map(function (v){return [v[1]]})\n          NUM.forEach(function (v,i,A){A[i][0]\u003di+1})\n          FORM.getRange(13,2,LL,1).setValues(NUM)\n          FORM.getRange(13,3,LL,7).setValues(REM)\n          SpreadsheetApp.flush()\n\n          var Serv\u003dD_SEL.map(function (v){return [v[5]]}).join(\u0027 \u0027)\n          var QR\u003dDIA.toLocaleString(\u0027es-CO\u0027,{ timeZone: \"America/Bogota\" })\n          var URL\u003d\"https://chart.googleapis.com/chart?chs\u003d100x100\u0026cht\u003dqr\u0026chl\u003d\"+encodeURI(QR)\n          FORM.getRange(\u0027I1\u0027).setFormula(\u0027\u003dIMAGE(\"\u0027+URL+\u0027\")\u0027)\n\n          if((TT\u003d\u003d\"CLIENTE RECOGE\")||(TT\u003d\u003d\"MENSAJERO\"))\n          {FORM.getRange(\u0027D10\u0027).setValue(TT)\n          var templ \u003d HtmlService.createTemplateFromFile(\u0027Bbody2\u0027);\n           var k\u003d0;\n              var MM\u003d\"\"\n              var Ind\u003dMAIL.toString().indexOf(\u0027@\u0027,0)\n              while(Ind!\u003d-1){ Ind\u003dMAIL.toString().indexOf(\u0027@\u0027,Ind+1)\n               k\u003dk+1}   \n             for(j\u003d0;j\u003ck;j++)\n              { if(MM\u003d\u003d\"\"){MM\u003dRR.exec(MAIL)} else{MM\u003dMM+\u0027,\u0027+RR.exec(MAIL)}\n              } RR.exec(MAIL)}\n          else{FORM.getRange(\u0027D10\u0027).setValue(GG+\u0027 - \u0027+TT)\n               var templ \u003d HtmlService.createTemplateFromFile(\u0027Bbody\u0027);\n              var k\u003d0;\n              var MM\u003d\"\"\n              var Ind\u003dMAIL.toString().indexOf(\u0027@\u0027,0)\n              while(Ind!\u003d-1){ Ind\u003dMAIL.toString().indexOf(\u0027@\u0027,Ind+1)\n               k\u003dk+1}   \n             for(j\u003d0;j\u003ck;j++)\n              { if(MM\u003d\u003d\"\"){MM\u003dRR.exec(MAIL)} else{MM\u003dMM+\u0027,\u0027+RR.exec(MAIL)}\n              } RR.exec(MAIL)\n             }SpreadsheetApp.flush()\n\n       //   var ENL \u003d \"https://docs.google.com/spreadsheets/d/1XpPS-gnMBoNuasvDdtXW38gXBDb0sp5im_L422rOr58/export?gid\u003d1968250466\u0026format\u003dpdf\u0026gridlines\u003dfalse\"\n \n           var parametros \u003d {muteHttpExceptions: true,headers: {Authorization: \u0027Bearer \u0027 + ScriptApp.getOAuthToken(),}}\n\n  var respuesta\u003dUrlFetchApp.fetch(ENL, parametros)\n  var blob\u003drespuesta.getAs(\"application/pdf\")\n  \n  templ.Cliente \u003d CLIENTE\n  templ.Guia\u003d GG\n  templ.Transportadora\u003dTT\n  templ.Servicios\u003d Serv\n  \n  var message \u003d templ.evaluate().getContent();\n\nGmailApp.sendEmail(MM,CLIENTE+\u0027 - ENTREGA DE DISPOSITIVOS\u0027,\u0027\u0027,\n  {htmlBody: message,\n   cc: \"atencioncliente@wi-mobile.com\",\n   replyTo: \"atencioncliente@wi-mobile.com\",\n   attachments: [blob.setName(CLIENTE+\u0027 - \u0027+FFF+\u0027 - \u0027+Serv)]})\n           var H_ST\u003dSpreadsheetApp.openById(\"1CGx8qzzzq1k4kGK0tLT5A3qzgbThyyVB2uk7ayvbv0Q\").getSheetByName(\u0027GLOBAL\u0027)\n            var DATA\u003d[TT,GG,FF]\n            var II\u003dD_SEL.map(function (v){return [v[21]]})\n            for(l\u003d0;l\u003cLL;l++){ var UU\u003dII[l][0]\n              H_ST.getRange(\u0027BB\u0027+UU+\u0027:BD\u0027+UU).setValues([DATA])\n              H_ST.getRange(\u0027A\u0027+UU).setValue(\"ENTREGADO\")\n              }\n        var U_R\u003dREG.getLastRow()+1\n        REG.getRange(U_R,1,LL,1).setValue(QR)\n        REG.getRange(U_R,2,LL,1).setValue(USER)\n        REG.getRange(U_R,3,LL,1).setValue(FFF)\n        REG.getRange(U_R,4,LL,1).setValue(SEDE)\n        REG.getRange(U_R,5,LL,1).setValue(CLIENTE)\n        REG.getRange(U_R,6,LL,7).setValues(REM)\n        HREM.getRange(\u0027F3:F4\u0027).clearContent()\n        \n        }\n        else{ui.alert(\u0027Alerta\u0027,\u0027Falta información casilla del sello (DEVOL ó # SELLO)\u0027,ui.ButtonSet.OK)}\n         }\n        }        \n       }\n      }\n    }\n    else{ ui.alert(\u0027Alerta\u0027,\u0027No se encuentra seleccionado ningún cliente\u0027,ui.ButtonSet.OK)}\n   }\n  }\n  else\n  {ui.alert(\u0027Alerta\u0027,\u0027Falta información para continuar con la remisión\u0027,ui.ButtonSet.OK)\n   if(FF\u003d\u003d\"\"){HREM.getRange(\u0027F2\u0027).setBackground(\"yellow\")}\n   if(TT\u003d\u003d\"\"){HREM.getRange(\u0027F3\u0027).setBackground(\"yellow\")}\n   if(GG\u003d\u003d\"\"){HREM.getRange(\u0027F4\u0027).setBackground(\"yellow\")}\n  }\n}\n\n"},{"id":"45472042-a65f-4e61-970a-be4124366afe","name":"Bbody","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n\n\u003chead\u003e\n  \u003cbase target\u003d\"_top\"\u003e\n\u003c/head\u003e\n\n\u003cbody\u003e\n  \u003cp\u003e\n    Buen dia\n  \u003c/p\u003e\n  \u003cp\u003eSeñores\u003cbr\u003e\n    \u003cb\u003e\u003c?\u003dCliente?\u003e\u003c/b\u003e\u003cbr\u003e\n  \u003c/p\u003e\n  \u003cp\u003e\n    Adjuntamos nota remisoria del despacho de el(los) dispositivo(s) de el(los) servicio(s) \u003c?\u003dServicios?\u003e bajo el número de guía \u003c?\u003dGuia?\u003e con la \u003c?\u003dTransportadora?\u003e\n  \u003c/p\u003e\n  \u003cbr\u003e\n  \u003cp\u003e Cordialmente, \u003c/p\u003e\n\n  \u003cp\u003e\u003cb\u003eÁrea de Soporte Técnico\u003c/b\u003e\u003cbr\u003e\n  \u003cfont color\u003d\"blue\"\u003eatencioncliente@wi-mobile.com\u003c/font\u003e\u003cbr\u003e\n  Cll 84 No 28 -12 El Polo Bogotá  - Colombia\u003cbr\u003e\n  PBX:(571)7422888 Ext: 2105\u003cbr\u003e\n  \u003ca href\u003d\"http://www.wi-mobile.com\" target\u003d\"_blank\"\u003ehttp://www.wi-mobile.com\u003c/a\u003e\n  \u003c/p\u003e\n\n\n\u003c/body\u003e\n\n\u003c/html\u003e"},{"id":"1121b445-55d2-4399-bd71-64fa9a981210","name":"Bbody2","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n\n\u003chead\u003e\n  \u003cbase target\u003d\"_top\"\u003e\n\u003c/head\u003e\n\n\u003cbody\u003e\n  \u003cp\u003e\n    Buen dia\n  \u003c/p\u003e\n  \u003cp\u003eSeñores\u003cbr\u003e\n    \u003cb\u003e\u003c?\u003dCliente?\u003e\u003c/b\u003e\u003cbr\u003e\n  \u003c/p\u003e\n  \u003cp\u003e\n    Adjuntamos nota remisoria de la entrega de el(los) dispositivo(s) de el(los) servicio(s) \u003c?\u003dServicios?\u003e bajo la modalidad \u003c?\u003dTransportadora?\u003e\n  \u003c/p\u003e\n  \u003cbr\u003e\n  \u003cp\u003e Cordialmente, \u003c/p\u003e\n\n  \u003cp\u003e\u003cb\u003eÁrea de Soporte Técnico\u003c/b\u003e\u003cbr\u003e\n  \u003cfont color\u003d\"blue\"\u003eatencioncliente@wi-mobile.com\u003c/font\u003e\u003cbr\u003e\n  Cll 84 No 28 -12 El Polo Bogotá  - Colombia\u003cbr\u003e\n  PBX:(571)7422888 Ext: 2105\u003cbr\u003e\n  \u003ca href\u003d\"http://www.wi-mobile.com\" target\u003d\"_blank\"\u003ehttp://www.wi-mobile.com\u003c/a\u003e\n  \u003c/p\u003e\n\n\u003c/body\u003e\n\n\u003c/html\u003e"}]}