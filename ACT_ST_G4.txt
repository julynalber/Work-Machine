{"files":[{"id":"c3ace535-6d8f-449c-a766-15e2ad621f8f","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"America/Bogota\",\n  \"dependencies\": {\n    \"libraries\": [{\n      \"userSymbol\": \"ADDONS_WM\",\n      \"libraryId\": \"1HWmIkt8Zbf_ob-mtzuUPl6VPWAdT8Mi_yTKj1YJpllilX2xC3vb5RKM7\",\n      \"version\": \"0\",\n      \"developmentMode\": true\n    }]\n  },\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"sheets\": {\n    \"macros\": [{\n      \"menuName\": \"SJJSJSJ\",\n      \"functionName\": \"SJJSJSJ\"\n    }, {\n      \"menuName\": \"ssdsdsd\",\n      \"functionName\": \"ssdsdsd\"\n    }, {\n      \"menuName\": \"sddsdsd\",\n      \"functionName\": \"sddsdsd\"\n    }, {\n      \"menuName\": \"dsdsdsd\",\n      \"functionName\": \"dsdsdsd\"\n    }]\n  }\n}"},{"id":"ef712445-3369-400e-8798-104e899b779c","name":"Código","type":"server_js","source":"function onEdit(e) {\n  var F \u003d e.range.getRow()\n  var C \u003d e.range.getColumn()\n  var V \u003d e.value\n  var S \u003d e.source.getActiveSheet().getName()\n  var PP \u003d SpreadsheetApp.getActiveSpreadsheet().getSpreadsheetTimeZone()\n  if(S!\u003d\u0027DB\u0027)\n  { ADDONS_WM.ONON(F,C,V,S,PP)\n  }\n  \n}\n\nfunction MODELOS_CLIENTES() {\n  var CLIENTES \u003d SpreadsheetApp.openById(\"1CGx8qzzzq1k4kGK0tLT5A3qzgbThyyVB2uk7ayvbv0Q\").getSheetByName(\u0027D\u0027) //Clientes\n  var MODELO \u003d SpreadsheetApp.openById(\"1CGx8qzzzq1k4kGK0tLT5A3qzgbThyyVB2uk7ayvbv0Q\").getSheetByName(\u0027C\u0027) //Modelos\n  var H_C \u003d SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027CLIENTES\u0027)\n  var H_M \u003d SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027MODELOS\u0027)\n\n  var L_C \u003d CLIENTES.getDataRange().getLastRow() + 5\n  var L_M \u003d MODELO.getDataRange().getLastRow() + 5\n  H_C.getRange(\u0027A2:A\u0027 + L_C).setValues(CLIENTES.getRange(\u0027A2:A\u0027 + L_C).getValues())\n  H_M.getRange(\u0027A1:C\u0027 + L_M).setValues(MODELO.getRange(\u0027A1:C\u0027 + L_M).getValues())\n}\n\nfunction MOVE_ROWS() {\n  var DIR \u003d SpreadsheetApp.openById(\"1nO_F5hIAGWV06PEhInnUZDhOaq5Z77_1GBAEzQodzQk\").getSheetByName(\"VAL\")\n  var SW \u003d DIR.getRange(\u0027B1\u0027).getValue()\n  Logger.log(SW)\n\n  if (SW \u003d\u003d 0) {\n    DIR.getRange(\u0027B1\u0027).setValue(1)\n    SpreadsheetApp.flush()\n    var INF \u003d SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"Act Abiertas\")\n    var D_INF \u003d INF.getDataRange().getValues()\n    var INF_C \u003d SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"Act Cerradas\")\n    var D_INF_C \u003d INF_C.getDataRange().getValues()\n\n    var U_C \u003d INF_C.getDataRange().getLastRow() + 1\n\n    var Filtro \u003d D_INF.filter(function (v, i) { return v[14] !\u003d\u003d \"\" \u0026\u0026 i \u003e 1 })\n\n    if (Filtro.length \u003e 0) {\n      var L \u003d Filtro.length + U_C - 1\n      Filtro.forEach(function (v, i, A) { if ((v[4] \u003d\u003d \"Revisión\") || (v[4] \u003d\u003d \"Reparación\")) { A[i][0] \u003d new Date } })\n\n      INF_C.getRange(\u0027A\u0027 + U_C + \u0027:Q\u0027 + L).setValues(Filtro)\n\n      var Filtro2 \u003d D_INF.map(function (v, i) { return [v[14], i + 1] }).filter(function (v) { return v[0] !\u003d\u003d \"\" \u0026\u0026 v[1] \u003e 1 })\n\n      for (j \u003d Filtro2.length - 1; j \u003e\u003d 0; j--) {\n        var RR \u003d Filtro2[j][1]\n\n        INF.deleteRow(RR)\n\n      }\n    }\n  } DIR.getRange(\u0027B1\u0027).setValue(0)\n\n}\n\nfunction RTD_1() {\n  var HOJA\u003d\u0027RTD_1\u0027\n  var D_TEC \u003d SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027TEC\u0027).getDataRange().getValues()\n  var Filtro\u003dD_TEC.filter(function (v){return v[0]\u003d\u003d\u003dHOJA})\n\n  var TEC \u003d Filtro[0][1]\n  var SEDE \u003d Filtro[0][2]\n  \n  var HT \u003d SpreadsheetApp.getActiveSpreadsheet().getSheetByName(HOJA)\n  var DB \u003d SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027DB\u0027) //\u003c------\n  ADDONS_WM.MOVEACT(HT,DB)     //\u003c------\n  var U_HT\u003dHT.getDataRange().getLastRow()\n  var U\u003dHT.getRange(\u0027C\u0027+U_HT).getNextDataCell(SpreadsheetApp.Direction.UP).getRow()\n  var DT\u003dHT.getRange(\u0027C2:H\u0027+U).getValues()\n\n  if(U\u003d\u003d1){ ADDONS_WM.ASIG(HT,TEC,SEDE,DB)}\n   if(U\u003e1){ var DT\u003dHT.getRange(\u0027C2:P\u0027+U).getValues()\n  var CT\u003dHT.getRange(\u0027C2:P\u0027+U).getBackgrounds()\n  var F\u003dU-1\n    //Logger.log(DT)\n    ADDONS_WM.ASIGv2(HT,DT,CT,TEC,SEDE,F,DB) }\n}\n\nfunction RTD_2() {\n  var HOJA\u003d\u0027RTD_2\u0027\n  var D_TEC \u003d SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027TEC\u0027).getDataRange().getValues()\n  var Filtro\u003dD_TEC.filter(function (v){return v[0]\u003d\u003d\u003dHOJA})\n\n  var TEC \u003d Filtro[0][1]\n  var SEDE \u003d Filtro[0][2]\n  \n  var HT \u003d SpreadsheetApp.getActiveSpreadsheet().getSheetByName(HOJA)\n  var DB \u003d SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027DB\u0027) //\u003c------\n  ADDONS_WM.MOVEACT(HT,DB)     //\u003c------\n  var U_HT\u003dHT.getDataRange().getLastRow()\n  var U\u003dHT.getRange(\u0027C\u0027+U_HT).getNextDataCell(SpreadsheetApp.Direction.UP).getRow()\n  var DT\u003dHT.getRange(\u0027C2:H\u0027+U).getValues()\n\n  if(U\u003d\u003d1){ ADDONS_WM.ASIG(HT,TEC,SEDE,DB)}\n   if(U\u003e1){ var DT\u003dHT.getRange(\u0027C2:P\u0027+U).getValues()\n  var CT\u003dHT.getRange(\u0027C2:P\u0027+U).getBackgrounds()\n  var F\u003dU-1\n    //Logger.log(DT)\n    ADDONS_WM.ASIGv2(HT,DT,CT,TEC,SEDE,F,DB)}\n}\n\n\nfunction DB()\n{ var DB \u003d SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027DB\u0027)\n  var D_DB\u003dDB.getDataRange().getValues()\n  var ID\u003d\u00271OshFoRSh-DmjO-R90mGqhGtsLzv5kSgzsoJ47rDac5o\u0027\n  \n  ADDONS_WM.DB(DB,D_DB,ID)\n}\n\nfunction CLEAN()\n  { for(i\u003d1;i\u003c\u003d5;i++)\n  { var HT\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027RTD_\u0027+i)\n    var C_HT\u003dHT.getDataRange().getBackgrounds()\n    ADDONS_WM.CLEAN(HT,C_HT)\n  }\n  }\n\nfunction VERIF()\n{ var Now\u003dnew Date ()\n  var Hour\u003dNow.getHours()*60\n  var Minutes\u003dNow.getMinutes()\n  \n  for(i\u003d1;i\u003c\u003d5;i++)\n  { var HT\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027RTD_\u0027+i)\n    var D_HT\u003dHT.getDataRange().getValues()\n    var DB\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027DB\u0027)\n    \n    var Filtro\u003dD_HT.map(function (v,i){return [v[18],i+1]}).filter(function (v){return v[0]!\u003d\u003d\"\"\u0026\u0026v[1]\u003e1})\n\n  if(Filtro.length\u003e0)\n  { for(j\u003d0;j\u003cFiltro.length;j++)\n  { var DD\u003dnew Date(Filtro[0][0])\n    var Eq\u003dDD.getHours()*60\n    var Mi\u003dDD.getMinutes()\n    if((Hour+Minutes)-(Eq+Mi)\u003e60)\n    { var U\u003dDB.getDataRange().getLastRow()+1\n      DB.getRange(\u0027A\u0027+U+\u0027:B\u0027+U).setValues([[\u0027RTD_\u0027+i,Filtro[j][1]]])}\n    }\n  }\n  }\n}\n\n\n"}]}