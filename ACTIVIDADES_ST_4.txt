{"files":[{"id":"717b53a1-e1ed-4252-87db-8dfe8a91d1c2","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"America/New_York\",\n  \"dependencies\": {\n  },\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"sheets\": {\n    \"macros\": [{\n      \"menuName\": \"BORRA_PROTECT_FILA\",\n      \"functionName\": \"BORRA_PROTECT_FILA\"\n    }, {\n      \"menuName\": \"tststst\",\n      \"functionName\": \"tststst\"\n    }, {\n      \"menuName\": \"msdm\",\n      \"functionName\": \"msdm\"\n    }]\n  }\n}"},{"id":"e6465572-6cd2-44d3-b324-8b91f9861c0b","name":"Código","type":"server_js","source":"function onEdit(e) \n{ if(e.source.getActiveSheet().getName()\u003d\u003d\"Actividades\")\n  { //SpreadsheetApp.getActiveSpreadsheet().toast(\"Prueba\",\"Aviso\",3)\n    var F\u003de.range.getRow()\n    var C\u003de.range.getColumn()\n    var V\u003de.value\n  \n      if((C\u003d\u003d20)\u0026\u0026(V!\u003dnull))\n    { var TS\u003dSpreadsheetApp.getActiveSheet().getRange(\u0027H\u0027+F).getValue()\n      if((TS\u003d\u003d\"Revisión\")||(TS\u003d\u003d\"Reparación\"))\n      { SpreadsheetApp.getActiveSheet().getRange(\u0027C\u0027+F).setValue(new Date)}\n      var PP\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"-\u003e\")\n      var FF\u003dPP.getRange(\u0027A500\u0027).getNextDataCell(SpreadsheetApp.Direction.UP).getRow()+1\n      PP.getRange(\u0027A\u0027+FF).setValue(F)    \n    }\n\n    if((C\u003d\u003d8)\u0026\u0026(V!\u003dnull))\n      { if(V\u003d\u003d\u0027Revisión\u0027){SpreadsheetApp.getActiveSheet().getRange(\u0027R\u0027+F).setValue(\"N/A\")}\n        if(V\u003d\u003d\u0027Reparación\u0027){SpreadsheetApp.getActiveSheet().getRange(\u0027Q\u0027+F).setValue(\"N/A\")}\n        if(V\u003d\u003d\u0027Alistamiento\u0027){SpreadsheetApp.getActiveSheet().getRangeList([\u0027L\u0027+F,\u0027Q\u0027+F+\u0027:S\u0027+F]).setValue(\"N/A\")}\n        if(V\u003d\u003d\u0027Gestión soporte\u0027){SpreadsheetApp.getActiveSheet().getRangeList([\u0027L\u0027+F,\u0027Q\u0027+F+\u0027:S\u0027+F]).setValue(\"N/A\")}\n      }\n\n    // if((C\u003d\u003d17)\u0026\u0026(V!\u003dnull))\n    // { var TS\u003dSpreadsheetApp.getActiveSheet().getRange(\u0027H\u0027+F).getValue()\n    //   var Rep\u003dV.toString().indexOf(\"ingun\",0)\n    //  // SpreadsheetApp.getActiveSpreadsheet().toast(\"Si en la revisión se determina que no requiere repuestos se debe colocar Ninguno. No confundir con N/A\",\u0027Aviso\u0027,10);\n\n    //   if((TS\u003d\u003d\"Revisión\"))\n    //   { //SpreadsheetApp.getActiveSheet().getRange(\u0027C\u0027+F).setValue(new Date)\n    //     var PP\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"-\u003e\")\n    //     var FF\u003dPP.getRange(\u0027A1\u0027).getValue()\n    //     //PP.getRange(\u0027A\u0027+FF).setValue(F)      \n    //   }\n    // }\n\n  }\n}\n\nfunction MODELOS_CLIENTES()\n{ var CLIENTES\u003dSpreadsheetApp.openById(\"1CGx8qzzzq1k4kGK0tLT5A3qzgbThyyVB2uk7ayvbv0Q\").getSheetByName(\u0027D\u0027) //Clientes\n  var MODELO\u003dSpreadsheetApp.openById(\"1CGx8qzzzq1k4kGK0tLT5A3qzgbThyyVB2uk7ayvbv0Q\").getSheetByName(\u0027C\u0027) //Modelos\n  var H_C\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027Clientes\u0027)\n  var H_M\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027Marca y Modelo\u0027)\n\nvar L_C\u003dCLIENTES.getDataRange().getLastRow()+5\nvar L_M\u003dMODELO.getDataRange().getLastRow()+5\n\nH_C.getRange(\u0027A2:A\u0027+L_C).setValues(CLIENTES.getRange(\u0027A2:A\u0027+L_C).getValues())\nH_M.getRange(\u0027A1:C\u0027+L_M).setValues(MODELO.getRange(\u0027A1:C\u0027+L_M).getValues())\n\n}\n\nfunction PROTECCION_FILAS()\n{var INF\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"Actividades\")\n var Filas\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\"-\u003e\")\n var D_INF\u003dINF.getDataRange().getValues()\n var D_Filas\u003dFilas.getDataRange().getValues()\n var F\u003dFilas.getRange(\u0027A500\u0027).getNextDataCell(SpreadsheetApp.Direction.UP).getRow()\n\n while(F\u003e1)\n   { var h\u003dF-1\n     var Index\u003dD_Filas[h][0].valueOf()\n     if(Index!\u003d\"\")\n     { //INF.getRange(Index+\u0027:\u0027+Index).setBackground(\"white\")\n       Filas.getRange(\u0027A\u0027+F).clearContent()\n     var INFO\u003dD_INF.map(function (v,i){return [v[7],v[12],new Date,v[15],v[16],v[17]]}).filter(function (v,i){return i+1\u003d\u003dIndex})\n     \n     if((INFO[0][0]\u003d\u003d\"Revisión\")\u0026\u0026(INFO[0][4]!\u003d\"N/A\"))\n     { INF.getRange(\u0027A\u0027+Index+\u0027:T\u0027+Index).protect().removeEditors([\u0027soportetecnico_bogota_03@wi-mobile.com\u0027,\u0027julynalber@gmail.com\u0027])    \n     }\n     if((INFO[0][0]\u003d\u003d\"Reparación\")\u0026\u0026(INFO[0][5]!\u003d\"N/A\"))\n     { INF.getRange(\u0027A\u0027+Index+\u0027:T\u0027+Index).protect().removeEditors([\u0027soportetecnico_bogota_03@wi-mobile.com\u0027,\u0027julynalber@gmail.com\u0027])    \n\n     }  \n   } var F\u003dFilas.getRange(\u0027A500\u0027).getNextDataCell(SpreadsheetApp.Direction.UP).getRow()\n  }\n }\n\n function BORRA_PROTECT_FILA()\n{var ss \u003d SpreadsheetApp.getActive();\n var Fila\u003dBrowser.inputBox(\u0027  Fila\u0027, \"\", Browser.Buttons.OK_CANCEL);\n var protections \u003d ss.getProtections(SpreadsheetApp.ProtectionType.RANGE);\n Logger.log(protections.length)\nfor (var i \u003d 0; i \u003c protections.length; i++) {\n  var protection \u003d protections[i];\n  var FF\u003dprotection.getRange().getA1Notation().indexOf(Fila,0)\n  if(FF\u003e-1)\n  { if (protection.canEdit()) {\n    protection.remove();\n     }\n  }\n}\n\n}\n"}]}