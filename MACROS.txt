{"files":[{"id":"05681f83-d4c1-4968-92b5-b73a15412574","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"America/Indiana/Indianapolis\",\n  \"dependencies\": {\n  },\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\"\n}"},{"id":"e5fe19a1-9885-4f85-af78-186d8ec98a31","name":"Código","type":"server_js","source":" function C_COT()\n  { var CFC\u003d\u0027C\u0027 //columna fecha de cotizacion\n    var AC\u003d\u0027E\u0027\n    var CS\u003d\u0027A\u0027//columna de caso\n    var Hoja\u003d SpreadsheetApp.getActiveSpreadsheet().getActiveSheet()\n    if(Hoja.getRange(CFC+\u00274\u0027).isBlank()){var p\u003d4}\n    else {p\u003dHoja.getRange(CFC+\u00273\u0027).getNextDataCell(SpreadsheetApp.Direction.DOWN).getRow()+1}\n  var ult\u003d Hoja.getDataRange().getLastRow()\n  var u\u003dHoja.getRange(CS+ult).getNextDataCell(SpreadsheetApp.Direction.UP).getRow() \n  \n    for(var i\u003d4;i\u003c900;i++)\n   { var Caso\u003d Hoja.getRange(CS+i).getValue();\n     var Cot\u003dHoja.getRange(CFC+i).getValue();\n\n    if(Cot.length\u003d\u003d0)\n    { Logger.log(i)\n      if(Caso\u003e0)\n        { var C\u003dGmailApp.search(\u0027subject:( CASO \u0027+Caso+\u0027) OR subject:( CASOS \u0027+Caso+\u0027)\u0027)\n          var Cont\u003dC.length\n            if(Cont\u003e0)\n             {var Men\u003dC[Cont-1].getMessages()\n               var D\u003dMen[0].getDate()\n               var As\u003dMen[0].getSubject()\n               Hoja.getRange(CFC+i).setValue(D) //Retorna dia\n               Hoja.getRange(AC+i).setValue(As) //Retorna dia\n             }\n            \n          }\n        }  \n      }\n  }\n\nfunction REENVIO()\n{  var Hoja\u003d SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027REENVIO COT\u0027)\n   var D_Hoja\u003dHoja.getDataRange().getValues()\n   var Ult\u003dHoja.getDataRange().getLastRow()\n\n  Logger.log(Ult)\n\n  for(i\u003d1;i\u003cUlt;i++)\n  { var ST\u003dD_Hoja[i][0]\n    \n    //var C\u003dGmailApp.search(\u0027subject:( CASO \u0027+ST+\u0027) OR subject:( CASOS \u0027+ST+\u0027)\u0027)\n    var C\u003dGmailApp.search(\u0027subject:(\u0027+ST+\u0027)\u0027)\n    var CC\u003dC.length\n    if(CC\u003e0)\n    { var M\u003dC[CC-1].getMessages()\n      var L\u003dM.length\n      var Cont\u003d0\n      for(j\u003d0;j\u003cL;j++)\n      { var GB\u003dM[j].getFrom()\n        var Ind\u003dGB.indexOf(\u0027dbeltran\u0027,0)\n\n       if(Ind\u003e1)\n       {Cont++\n        var Fecha\u003dM[j].getDate()\n        var AA\u003dM[j].getSubject()\n       }     \n      }\n      if(Cont\u003e0)\n      { var k\u003di+1\n        Hoja.getRange(\u0027B\u0027+k).setValue(Cont)\n        Hoja.getRange(\u0027C\u0027+k).setValue(Fecha)\n        Hoja.getRange(\u0027D\u0027+k).setValue(AA)\n        Cont\u003d0\n      }\n  }\n\n }\n}\n\n\n\n function C_APROB()\n  { var CS\u003d\u0027A\u0027//columna de servicio\n    var CRC\u003d\u0027G\u0027 //columna de respuesta cliente\n    var CRA\u003d\u0027H\u0027 //columna de correo de respuesta de aprobación\n    //var CBC\u003d\u0027I\u0027 //columna de cuerpo de correo\n    var Hoja\u003d SpreadsheetApp.getActiveSpreadsheet().getActiveSheet()\n   if(Hoja.getRange(CRC+\u00274\u0027).isBlank()){var p\u003d4}  //Columna Fecha Repuesta Cliente\n   else {p\u003dHoja.getRange(CRC+\u00273\u0027).getNextDataCell(SpreadsheetApp.Direction.DOWN).getRow()+1}\n   var ult\u003d Hoja.getDataRange().getLastRow()\n   var u\u003dHoja.getRange(CS+ult).getNextDataCell(SpreadsheetApp.Direction.UP).getRow() \n  \n   for(var i\u003d2400;i\u003c4700;i++)\n   { var Caso\u003d Hoja.getRange(CS+i).getValue();\n     var Resp\u003dHoja.getRange(CRC+i).getValue();\n     \n    if(Resp.length\u003d\u003d0)\n    { if(Caso\u003e0)\n        { var C\u003dGmailApp.search(\u0027subject:( CASO \u0027+Caso+\u0027) OR subject:( CASOS \u0027+Caso+\u0027)\u0027)//(\u0027subject:( CASO 16500 ) OR subject:( CASOS 16500 )\u0027) // //\n          var Cont\u003dC.length\n           if(Cont\u003e0)\n             { var M\u003dC[Cont-1].getMessages().length\n                if(M\u003d\u003d1)\n                { Hoja.getRange(CRC+i).setValue(\u0027SIN RESPUESTA SOBRE EL MISMO CORREO\u0027)\n                }\n                \n                if(M\u003e1)\n                { var MM\u003dC[Cont-1].getMessages();\n                  if(M\u003e3){M\u003d3}\n                  for (var k\u003dM-1;k\u003e0;k--)\n                  { var D\u003dMM[k].getDate()\n                    var Ap\u003dMM[k].getFrom()\n                    var l\u003dAp.indexOf(\"\u003c\")\n                    if(Ap.indexOf(\"\u003c\")\u003d\u003d-1)\n                    { var AP\u003dAp\n                    }\n                     else\n                     {var l\u003dAp.indexOf(\"\u003c\")\n                      var b\u003dAp.indexOf(\"\u003e\")\n                      var AP\u003dAp.slice(l,b+1)\n                     }\n                    \n                    if((AP!\u003d\"\u003catencioncliente@wi-mobile.com\u003e\")\u0026\u0026(AP!\u003d\"\u003cdbeltran@wi-mobile.com\u003e\")\u0026\u0026(AP!\u003d\"\u003csoportetecnico@wi-mobile.com\u003e\")\u0026\u0026(AP!\u003d\"\u003csoporteadmin@wi-mobile.com\u003e\")\u0026\u0026(AP!\u003d\"\u003cdabadia@wi-mobile.com\u003e\")\u0026\u0026(AP!\u003d\"\u003coperador@wi-mobile.com\u003e\"))\n                    {Hoja.getRange(CRC+i).setValue(D)//Retorna dia\n                     Hoja.getRange(CRA+i).setValue(AP)//correo de quien responde\n                     }\n                     else\n                     { var RR\u003dMM[k].getReplyTo()\n                       Logger.log(RR)\n                       if(RR.length\u003e0)\n                       {var l\u003dRR.indexOf(\"\u003c\")\n                        var b\u003dRR.indexOf(\"\u003e\")\n                        var AP\u003dRR.slice(l,b+1)\n                        Hoja.getRange(CRC+i).setValue(D)//Retorna dia\n                        Hoja.getRange(CRA+i).setValue(AP)//correo de quien responde\n                       }\n                       else\n                       { var BC\u003dMM[k].getPlainBody()\n                         var II\u003dBC.indexOf(\"Forwarded message\")\n                           Logger.log(\"SI\")\n                         Logger.log(II)\n                          if(II\u003e-1)\n                         { var CA\u003dBC.slice(II+33,II+150)\n                           var l\u003dCA.indexOf(\"\u003c\")\n                           var b\u003dCA.indexOf(\"\u003e\")\n                           var Am\u003dCA.slice(l,b+1)\n                           var r\u003dCA.indexOf(\"Date:\")\n                           var s\u003dCA.indexOf(\"2020\")\n                           var DD\u003dCA.slice(r+12,s+4)\n                           \n                           Logger.log(Am)\n                           if((Am!\u003d\"\u003catencioncliente@wi-mobile.com\u003e\")\u0026\u0026(Am!\u003d\"\u003cdbeltran@wi-mobile.com\u003e\")\u0026\u0026(Am!\u003d\"\u003csoportetecnico@wi-mobile.com\u003e\")\u0026\u0026(Am!\u003d\"\u003csoporteadmin@wi-mobile.com\u003e\")\u0026\u0026(Am!\u003d\"\u003cdabadia@wi-mobile.com\u003e\")\u0026\u0026(AP!\u003d\"\u003coperador@wi-mobile.com\u003e\"))\n                              {Hoja.getRange(CRC+i).setValue(DD)//Retorna dia\n                               Hoja.getRange(CRA+i).setValue(Am)//correo de quien responde\n                               }\n                        }\n                       }\n             \n                      }\n                   \n                }  \n              }                \n           }\n       }\n             \n     }\n  }\n }\n    "}]}