{"files":[{"id":"5f4019ff-e22a-44c4-956e-f9b510511f1c","name":"Código","type":"server_js","source":"\n//GARANTIA DE REPARACION\n\nfunction G_R(S,FR,F,C)\n{ var D\u003d5;\n  var Hoja\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027GLOBAL\u0027)\n\nif((S\u003d\u003d\"\")||(FR\u003d\u003d\"\"))\n  { return \"\"; }\n  else\n  { for(var i\u003dF-1;i\u003e3;i--)\n    { var SComp\u003dHoja.getRange(i,C).getValue()\n     if(S\u003d\u003dSComp)\n      {var FComp\u003dHoja.getRange(i,D).getValue()\n       var RComp\u003d(FR-FComp)/(1000*60*60*24)\n       if(RComp\u003c180){return \"SI APLICA\";}\n      }\n    }\n  return \"NO APLICA\";\n }\n}\n\n\nfunction EST(F1,F2,F3,F4,F5,F6,EA,F7,F8, En,F9,F10)\n{\n  var J\u003d\"\"\n\n if(F1\u003e0) { J\u003d\"INGRESANDO\" }\n if(F2\u003e0){ J\u003d\"EN REVISIÓN\"}\n if(F3\u003e0) { J\u003d\"CASO ESCALADO\"}\n if(F4\u003e0) { J\u003d\"DIAGNOSTICADO\"}\n if(F5\u003e0) { J\u003d\"COTIZADO\"}\n if(F6\u003e0) \n { if(EA \u003d\u003d\"APROBADO\") {J\u003d\"SOLICITANDO REPUESTOS\"}\n  if(EA \u003d\u003d\"NO APROBADO\"){J\u003d\"DEVOLVER SIN REPARAR\"}       \n  }\n if(F7\u003e0) { J\u003d\"REPUESTOS SOLICITADOS\"}\n if(F8\u003e0)\n {if(En \u003d\u003d\"TOTAL\") {J\u003d\"EN REPARACIÓN\"}\n  else{J\u003d\"PENDIENTE POR REPUESTOS\"}       \n }\n if(F9\u003e0) { J\u003d\"REPARADO\"}\n if(F10\u003e0) { J\u003d\"ENTREGADO\"}\n\n\nreturn J\n}\n\n\n\n\n\n\n\n\n\n\n\n\n//ESTADO ORDEN DE COMPRA\nfunction E_OC(EA,FOC)\n{ var J\u003d\"\"\nif(FOC\u003d\u003d\"N/A\"){ J\u003d\"N/A\"}\nif(FOC\u003e0){J\u003d\"ORDEN RECIBIDA\"}\nif((FOC\u003c1\u0026\u0026EA\u003d\u003d\"APROBADO\")||(FOC\u003c1\u0026\u0026EA\u003d\u003d\"NO APROBADO\")){J\u003d\"PENDIENTE OC\"}\n\nreturn J\n}\n\n////////////////////////////\n\n//NUMERO ORDEN DE COMPRA\nfunction N_OC(EA,FOC)\n{ var J\u003d\"\"\nif(FOC\u003d\u003d\"N/A\"){ J\u003d\"N/A\"}\n\nreturn J\n}\n\n\n\n\n\n//FECHA DE ENTREGA\n\nfunction F_E(FET,FEM,FEC)\n{ if(FET\u003e0){return FET}\n  if(FEM\u003e0) {return FEM}\n  if(FEC\u003e0) {return FEC}\n  \n}"},{"id":"d62eb728-1b92-4abf-bcd1-f5e3b99eea09","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"America/Indiana/Indianapolis\",\n  \"dependencies\": {\n  },\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"sheets\": {\n    \"macros\": [{\n      \"menuName\": \"HHH\",\n      \"functionName\": \"HHH\"\n    }, {\n      \"menuName\": \"VALIDACION\",\n      \"functionName\": \"VALIDACION\"\n    }, {\n      \"menuName\": \"yyyy\",\n      \"functionName\": \"yyyy\"\n    }, {\n      \"menuName\": \"C_LINKS\",\n      \"functionName\": \"C_LINKS\"\n    }, {\n      \"menuName\": \"trerer\",\n      \"functionName\": \"trerer\"\n    }, {\n      \"menuName\": \"fdsfsfsf\",\n      \"functionName\": \"fdsfsfsf\"\n    }, {\n      \"menuName\": \"S_REP\",\n      \"functionName\": \"S_REP\"\n    }]\n  }\n}"},{"id":"85c68f2a-8cfb-44a5-9e72-1745e619c8af","name":"macros","type":"server_js","source":"//SpreadsheetApp.getActiveSpreadsheet().toast(T,\u0027Prueba\u0027,6);\n\n//CAMBIO CORREO A NOMBRE\n\nfunction CORREO(T)\n{ var Tec\u003d SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027B\u0027)\n  var U\u003dTec.getDataRange().getLastRow()\n  for(var i\u003d1;i\u003c\u003dU;i++)\n  {var valor\u003dTec.getRange(i,2).getValue()\n   if(T\u003d\u003dvalor)\n   {var R\u003dTec.getRange(i,1).getValue()\n   return R\n   }\n  }  \n}\n\n//CORREOS PERSONAS QUE APRUEBAN\n\nfunction APROB(T)\n{ switch (T)\n  {case \"\u003cymejia@postobon.com.co\u003e\": // YOVANY MEJIA\n    return 1;\n    break;\n  }\n return 0;\n}\n\n//FUNCION CREACIÓN LINKS INTRANET\n\nfunction C_LINKS()\n{\nvar Hoja\u003d SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027GLOBAL\u0027)\nvar Rango\u003dHoja.getActiveRange();\nvar R\u003dHoja.getActiveCell();\nvar fin\u003dRango.getNumRows();\n\nfor(var i\u003d0;i\u003cfin;i++)\n{var Celda\u003dR.offset(i,0)\n var inicio\u003dCelda.getValue().slice(0,4)\n if(inicio\u003d\u003d\"http\"){}\n else{ var valor\u003d\"https://intranetwmnew.wi-mobile.com/solicitudes/items/\"+Celda.getValue().slice(0,17)\n       Celda.setValue(valor).setShowHyperlink(true);\n   }\n } \n}\n\n  \n//FUNCION CORREO DE DIAGNOSTICO\n   \n function C_DIAG()\n{ var CS\u003d\u0027N\u0027//columna de servicio\n  var CFD\u003d\u0027X\u0027 //columna de fecha de diagnostico\n  var CSs\u003d\u0027R\u0027 //columna de serial\n  var CT\u003d\u0027Y\u0027 //columna de tecnico\n  var CFEC\u003d\u0027W\u0027 //columna de escalamiento de caso\n  var Hoja\u003d SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027GLOBAL\u0027);\n    if(Hoja.getRange(CFD+\u00274\u0027).isBlank()){var p\u003d4}\n    else {p\u003dHoja.getRange(CFD+\u00273\u0027).getNextDataCell(SpreadsheetApp.Direction.DOWN).getRow()+1}\n  var ult\u003d Hoja.getDataRange().getLastRow()\n  var u\u003dHoja.getRange(CS+ult).getNextDataCell(SpreadsheetApp.Direction.UP).getRow() \n  \n  for(var i\u003dp;i\u003cu+1;i++)\n  { var Servicio\u003dHoja.getRange(CS+i).getValue();\n    var Serial\u003dHoja.getRange(CSs+i).getValue();\n    var Diag\u003dHoja.getRange(CFD+i).getValue();\n\n    if((Serial.length\u003e0)\u0026\u0026(Servicio.length\u003e0)\u0026\u0026(Diag.length\u003d\u003d0))\n    { var Asunto\u003dServicio+\" DIAGNOSTICADO\";\n      var C\u003dGmailApp.search(\u0027subject:\"\u0027+Asunto+\u0027\" \u0027+Serial)\n           if(C.length\u003e0)\n             { var M\u003dC[0].getMessages()\n               var D\u003dM[0].getDate()  \n               Hoja.getRange(CFD+i).setValue(D) //Retorna dia\n               var F\u003dM[0].getFrom()\n               var l\u003dF.indexOf(\"\u003c\")\n               var b\u003dF.indexOf(\"\u003e\")\n               var T\u003dF.slice(l+1,b)\n               var Tec\u003dCORREO(T); \n               Hoja.getRange(CT+i).setValue(Tec) //Retorna tecnico\n               }\n          else\n             {Asunto\u003dServicio+\" ESCALAMIENTO DE CASO\";\n              C\u003dGmailApp.search(\u0027subject:\"\u0027+Asunto+\u0027\" \u0027+Serial)\n               if(C.length\u003e0)\n                 { var M\u003dC[0].getMessages()\n                   var D\u003dM[0].getDate()  \n                   Hoja.getRange(CFEC+i).setValue(D) //Retorna dia\n                   var F\u003dM[0].getFrom()\n                   var l\u003dF.indexOf(\"\u003c\")\n                   var b\u003dF.indexOf(\"\u003e\")\n                   var T\u003dF.slice(l+1,b)\n                   var Tec\u003dCORREO(T); \n                   Hoja.getRange(CT+i).setValue(Tec) //Retorna tecnico\n                 }\n             }\n     }\n   }\n }   \n  \n function C_COT()\n  { var CFC\u003d\u0027AA\u0027 //columna fecha de cotizacion\n    var CS\u003d\u0027N\u0027//columna de servicio \n    var Hoja\u003d SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027GLOBAL\u0027);\n    if(Hoja.getRange(CFC+\u00274\u0027).isBlank()){var p\u003d4}\n    else {p\u003dHoja.getRange(CFC+\u00273\u0027)..getNextDataCell(SpreadsheetApp.Direction.DOWN).getRow()+1}\n  var ult\u003d Hoja.getDataRange().getLastRow()\n  var u\u003dHoja.getRange(CS+ult).getNextDataCell(SpreadsheetApp.Direction.UP).getRow() \n  \n \n  for(var i\u003dp;i\u003cu+1;i++)\n   { var j\u003di-1\n     var Celdaact\u003d Hoja.getRange(CS+i).getValue();\n     var Celdaant\u003d Hoja.getRange(CS+j).getValue();\n     var Cot\u003dHoja.getRange(CFC+i).getValue();\n    if(Cot.length\u003d\u003d0)\n    {\n     if (Celdaant\u003d\u003dCeldaact)\n        { Hoja.getRange(CFC+i).setValue(Hoja.getRange(CFC+j).getValue()) }\n    else\n        {if(Celdaact.length\u003e0)\n         { var Asunto\u003d Celdaact+\" INFORME\";\n          var C\u003dGmailApp.search(\u0027subject:\"\u0027+Asunto+\u0027\"\u0027)\n           if(C.length\u003e0)\n             { var M\u003dC[0].getMessages()\n               var D\u003dM[0].getDate()  \n               Hoja.getRange(CFC+i).setValue(D) //Retorna dia\n             }\n          }\n        }  \n      }\n    }\n  }\n  \n  function S_REP()\n  { var CS\u003d\u0027N\u0027 //columna servicio\n    var CSR\u003d\u0027AI\u0027 //columna solicitar repuestos\n    var CNP\u003d\u0027AK\u0027 //columna numero de pedido\n    var CFP\u003d\u0027AJ\u0027 //columna fecha de pedido\n  \n    var Hoja\u003d SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027GLOBAL\u0027);\n    var CeldaAct\u003dHoja.getActiveCell().getA1Notation()\n    if(Hoja.getRange(CNP+\u00274\u0027).isBlank()){var p\u003d4}\n    else {p\u003dHoja.getRange(CNP+\u00273\u0027).getNextDataCell(SpreadsheetApp.Direction.DOWN).getRow()+1}\n    var ult\u003d Hoja.getDataRange().getLastRow()\n    var u\u003dHoja.getRange(CS+ult).getNextDataCell(SpreadsheetApp.Direction.UP).getRow()\n    \n    for(var i\u003d100;i\u003c200;i++)\n    {  var k\u003di-1\n       var Celdaact\u003d Hoja.getRange(CS+i).getValue();\n       var Celdaant\u003d Hoja.getRange(CS+k).getValue();\n       var PP\u003dHoja.getRange(CNP+i).getValue();\n     if(PP.length\u003d\u003d0)\n     {\n     if (Celdaant\u003d\u003dCeldaact)\n        { var EE\u003dHoja.getRange(CFP+k+\u0027:\u0027+CNP+k).getValues() \n        Hoja.getRange(CFP+i+\u0027:\u0027+CNP+i).setValues(EE)\n            \n        }\n     else\n     { var Arc \u003dHoja.getRange(CS+i).getValue().slice(8,15)\n       var C\u003dGmailApp.search(\u0027filename:\u0027+Arc)\n       if(C.length\u003e0)\n       {var M\u003dC[0].getMessages()\n        var FPed\u003dM[0].getDate()\n        var AR\u003dM[0].getAttachments()\n        var A\u003dM[0].getAttachments().length\n        for(var j\u003d0;j\u003cA;j++)\n         { var Ped\u003dAR[j].getName()\n           var B\u003dPed.indexOf(Arc)\n           if(B\u003e0)\n           {var P\u003dPed.slice(0,10)\n            Hoja.getRange(CFP+i).setValue(FPed)\n            Hoja.getRange(CNP+i).setValue(P)\n            break;\n           }\n         }\n       }\n     }\n    }\n   }\n }   \n  //var Cuerpo\u003dM[0].getPlainBody()\n   //var In\u003dCuerpo.indexOf(\"Observaciones\")+14\n   //var Fin\u003dCuerpo.indexOf(\"Cordialmente\")\n   //var Obs\u003dCuerpo.slice(In,Fin)\n  // Hoja.getRange(\u0027AO4\u0027).setValue(Obs)\n      //Logger.log(Obs)\n\n function E_REP()\n  { var CS\u003d\u0027N\u0027 //columna servicio\n    var CSR\u003d\u0027AI\u0027 //columna solicitar repuestos\n    var CNP\u003d\u0027AK\u0027 //columna numero de pedido\n    var CFP\u003d\u0027AJ\u0027 //columna fecha de pedido\n    var CER\u003d\u0027AL\u0027 //columna entrega de repuestos\n  \n    var Hoja\u003d SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027GLOBAL\u0027);\n    var CeldaAct\u003dHoja.getActiveCell().getA1Notation()\n    if(Hoja.getRange(CNP+\u00274\u0027).isBlank()){var p\u003d4}\n    else {p\u003dHoja.getRange(CNP+\u00273\u0027).getNextDataCell(SpreadsheetApp.Direction.DOWN).getRow()+1}\n    var ult\u003d Hoja.getDataRange().getLastRow()\n    var u\u003dHoja.getRange(CS+ult).getNextDataCell(SpreadsheetApp.Direction.UP).getRow()\n    \n    for(var i\u003d196;i\u003c216;i++)\n    {  var k\u003di-1\n       var Celdaact\u003d Hoja.getRange(CS+i).getValue();\n       var Celdaant\u003d Hoja.getRange(CS+k).getValue();\n       var PP\u003dHoja.getRange(CNP+i).getValue();\n    // Logger.log(PP)\n     if(PP.length\u003e0)\n     {\n     var Arc \u003dHoja.getRange(CNP+i).getValue().slice(1,10)\n       Arc \u003d \u0027R\u0027+Arc\n       var C\u003dGmailApp.search(\u0027filename:\u0027+Arc)\n       if(C.length\u003e0)\n       {var M\u003dC[0].getMessages()\n        var LL\u003dM.length\n        Logger.log(LL)\n        for (var k\u003d1;k\u003cLL;k++)\n        {//var FPed\u003dM[0].getDate()\n        var AR\u003dM[k].getAttachments()\n        var A\u003dAR.length\n        for(var j\u003d0;j\u003cA;j++)\n         { var Rem\u003dAR[j].getName().slice(0,10)\n           if(Arc\u003d\u003dRem)\n           { var FF\u003dM[k].getDate()\n             Hoja.getRange(CER+i).setValue(FF)\n             Logger.log(FF)\n            }\n         } }\n       }\n     }\n    \n   }\n }   \n\n\n\n function C_APROB()\n  { var CS\u003d\u0027N\u0027//columna de servicio\n    var CRC\u003d\u0027AD\u0027 //columna de respuesta cliente\n    var Hoja\u003d SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027GLOBAL\u0027);\n   if(Hoja.getRange(CRC+\u00274\u0027).isBlank()){var p\u003d4}  //Columna Fecha Repuesta Cliente\n   else {p\u003dHoja.getRange(CRC+\u00273\u0027).getNextDataCell(SpreadsheetApp.Direction.DOWN).getRow()+1}\n   var ult\u003d Hoja.getDataRange().getLastRow()\n   var u\u003dHoja.getRange(CS+ult).getNextDataCell(SpreadsheetApp.Direction.UP).getRow() \n  \n   for(var i\u003d1410;i\u003c1600;i++)\n   { var j\u003di-1\n     var Celdaact\u003d Hoja.getRange(CS+i).getValue();\n     var Celdaant\u003d Hoja.getRange(CS+j).getValue();\n     var Cot\u003dHoja.getRange(CRC+i).getValue();\n    if(Cot.length\u003d\u003d0)\n    {\n     if (Celdaant\u003d\u003dCeldaact)\n        { Hoja.getRange(CRC+i).setValue(Hoja.getRange(CRC+j).getValue()).setBackground(\u0027#ffe599\u0027) }\n    else\n        {if(Celdaact.length\u003e0)\n         {var Asunto\u003d Celdaact\n          var C\u003dGmailApp.search(\u0027subject:\"\u0027+Asunto+\u0027\"\u0027)\n           if(C.length\u003e0)\n             { var M\u003dC[0].getMessages().length\n                if(M\u003e1)\n                {for (var k\u003d1;k\u003cM;k++)\n                 { var MM\u003dC[0].getMessages();\n                   var Ap\u003dMM[k].getFrom()\n                   var l\u003dAp.indexOf(\"\u003c\")\n                   var b\u003dAp.indexOf(\"\u003e\")\n                   var AP\u003dAp.slice(l,b+1)\n                   Logger.log(AP)\n                  if(APROB(AP)\u003d\u003d1)\n                   { var D\u003dMM[k].getDate()\n                     Hoja.getRange(CRC+i).setValue(D).setBackground(\u0027#ffe599\u0027) //Retorna dia  }  \n                   }                \n                 }\n               }\n             \n             }\n           }\n        }\n     }\n   }  \n }\n  \n  \n  \n  function C_REP()\n{ \n  \n  var Hoja\u003d SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027GLOBAL\u0027);\n  var p\u003dHoja.getRange(\"AJ3\").getNextDataCell(SpreadsheetApp.Direction.DOWN).getRow()+1;\n  var ult\u003d Hoja.getDataRange().getLastRow();\n  var u\u003dHoja.getRange(\"K\"+ult).getNextDataCell(SpreadsheetApp.Direction.UP).getRow(); \n \n\n   for(var i\u003dp;i\u003c\u003du;i++)\n  { var Estado\u003d Hoja.getRange(\u0027Y\u0027+i).getValue()\n       if(Estado\u003d\u003d\"APROBADO\")\n        { var Servicio\u003dHoja.getRange(\u0027K\u0027+i).getValue();\n          if(Servicio.length\u003e0)\n          { var Serial\u003dHoja.getRange(\u0027O\u0027+i).getValue();\n            var Asunto\u003d Servicio+\" REPARADO\";\n            var C\u003dGmailApp.search(\u0027subject:\"\u0027+Asunto+\u0027\" \u0027+Serial)\n            if(C.length\u003e0)\n             { var M\u003dC[0].getMessages()\n               var D\u003dM[0].getDate()  \n               Hoja.getRange(\u0027AJ\u0027+i).setValue(D) //Retorna dia\n               var F\u003dM[0].getFrom()\n               var l\u003dF.indexOf(\"\u003c\")\n               var b\u003dF.indexOf(\"\u003e\")\n               var T\u003dF.slice(l+1,b)\n               var Tec\u003dCORREO(T); \n               Hoja.getRange(\u0027AK\u0027+i).setValue(Tec)\n              \n             }\n          }\n       }\n       if(Estado\u003d\u003d\"NO APROBADO\")\n        { Hoja.getRange(\u0027AJ\u0027+i).setValue(\u0027N/A\u0027);\n         }\n       }\n   }\n\n\nfunction CLEAN ()\n\n{ var Hoja\u003d SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027GLOBAL\u0027);\n  var ult\u003d Hoja.getDataRange().getLastRow();\n  \n var C\u003d [\u0027H\u0027,\u0027K\u0027,\u0027Q\u0027,]\n var L\u003dC.length\n \n for( var j\u003d1;j\u003cL;j++)  \n  {for( var i\u003d4;i\u003c1500;i++)\n      {if(Hoja.getRange(C[j]+i).isBlank()){}\n       else\n         {if(Hoja.getRange(C[j]+i).getFormula().length\u003e0)\n             {var R\u003dHoja.getRange(C[j]+i).getValue().toString()\n             Hoja.getRange(C[j]+i).setValue(R)\n             }\n             \n             \n          } \n      }\n   }\n}\n\n\n\n"}]}