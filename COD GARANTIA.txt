{"files":[{"id":"a8af22d8-6d16-4d75-9f5e-a92aa4fe4b5a","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"America/New_York\",\n  \"dependencies\": {\n  },\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"sheets\": {\n    \"macros\": [{\n      \"menuName\": \"sdsd\",\n      \"functionName\": \"sdsd\"\n    }, {\n      \"menuName\": \"ASDAS\",\n      \"functionName\": \"ASDAS\"\n    }, {\n      \"menuName\": \"ASDS\",\n      \"functionName\": \"ASDS\"\n    }, {\n      \"menuName\": \"FIN_GARANTIA\",\n      \"functionName\": \"FIN_GARANTIA\"\n    }, {\n      \"menuName\": \"jhhkjhjkh\",\n      \"functionName\": \"jhhkjhjkh\"\n    }, {\n      \"menuName\": \"DIR_GTIA\",\n      \"functionName\": \"DIR_GTIA\"\n    }, {\n      \"menuName\": \"SERIAL_GTIA\",\n      \"functionName\": \"SERIAL_GTIA\"\n    }]\n  }\n}"},{"id":"37507e27-daa8-4ba5-b2f4-532e8883220d","name":"macros","type":"server_js","source":"function DIR_GTIA()\r\n{ SERIAL_GTIA()\r\n  SpreadsheetApp.flush()\r\n\r\n  var ST\u003dSpreadsheetApp.openById(\"1CGx8qzzzq1k4kGK0tLT5A3qzgbThyyVB2uk7ayvbv0Q\").getSheetByName(\u0027GLOBAL\u0027)\r\n  var D_ST\u003dST.getRange(\u0027D:D\u0027).getValues().map(function (v,i){return [v[0],i+1]})\r\n\r\n  var Hoja\u003d SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027VAL\u0027);\r\n  var D_Hoja\u003dHoja.getDataRange().getValues()\r\n  var Ult\u003dD_Hoja.length\r\n\r\n  var Enlaces\u003d SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027ENLACES\u0027);\r\n  var D_Enl\u003dEnlaces.getDataRange().getValues()\r\n  \r\n  var D_GTIA\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027GTIA\u0027).getDataRange().getValues()\r\n  var D_ESP\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027ESP\u0027).getDataRange().getValues()\r\n  var EE\u003dD_ESP.length\r\n\r\n  for(e\u003d1;e\u003cEE;e++)\r\n  { var CLIENT\u003dD_ESP[e][0]\r\n    var MODD\u003dD_ESP[e][1]\r\n     var ESP\u003dD_Hoja.map(function (v,i){return [v[2],v[3],v[5],i+1]}).filter(function (v){return v[0]\u003d\u003d\u003dCLIENT\u0026\u0026v[1]\u003d\u003d\u003dMODD})\r\n     if(ESP.length\u003e0)\r\n    { for(f\u003d0;f\u003cESP.length;f++)\r\n      { Logger.log(\u0027f\u003d\u0027+f)\r\n      var FF\u003dESP[f][3]\r\n      var II\u003dESP[f][2]\r\n      Logger.log(\u0027Index\u003d\u0027+II)\r\n      ST.getRange(\u0027X\u0027+II).setValue(\u0027NO APLICA\u0027)\r\n      ST.getRange(\u0027Z\u0027+II+\u0027:AB\u0027+II).setValues([[\"VIGENTE\",D_ESP[e][2].valueOf(),D_ESP[e][3].valueOf()]])\r\n      Hoja.deleteRow(FF)\r\n      Ult\u003dUlt-1\r\n      }\r\n    }\r\n  }\r\n  var D_Hoja\u003dHoja.getDataRange().getValues()\r\n\r\n  var Mod\u003dD_Enl.map(function (v){return v[0]}).concat()\r\n\r\n   for(i\u003d1;i\u003cUlt;i++)\r\n  { Logger.log(\"i\u003d\"+i)\r\n    var MODD\u003dD_Hoja[i][3]\r\n    var Index\u003dMod.indexOf(MODD,0)\r\n    if((Index\u003e-1))\r\n    { var HH\u003dSpreadsheetApp.openById(D_Enl[Index][1])\r\n      var Data\u003dHH.getDataRange().getValues()\r\n      var Filtro\u003dD_Hoja.filter(function (v){return v[3]\u003d\u003d\u003dMODD})\r\n      var LL\u003dFiltro.length\r\n      Logger.log(\"LL\u003d \"+LL)\r\n           \r\n      for(j\u003d0;j\u003cLL;j++)\r\n      { Logger.log(\"j\u003d\"+j)\r\n        var SS\u003dFiltro[j][0].toString()\r\n        \r\n        var Comp\u003dData.filter(function (v){return v[0].toString()\u003d\u003d\u003dSS})\r\n        Logger.log(\"SS\u003d \"+Comp)\r\n        var MM\u003dMODD.toString().indexOf(\"ARMOR\",0)\r\n        var MM2\u003dMODD.toString().indexOf(\"NLV-4001\",0)\r\n        var MM3\u003dMODD.toString().indexOf(\"FM100\",0)\r\n        if((Comp.length\u003d\u003d0)\u0026\u0026(MM\u003e-1)){Comp\u003dData.filter(function (v){return v[13].toString()\u003d\u003d\u003dSS||v[14].toString()\u003d\u003d\u003dSS})}\r\n        if(((Comp.length\u003d\u003d0)\u0026\u0026(MM2\u003e-1))||((Comp.length\u003d\u003d0)\u0026\u0026(MM3\u003e-1)))\r\n        {var PL\u003dFiltro[j][6].toString().slice(-6)\r\n        if(PL.toString().slice(0,1)\u003d\u003d\u00270\u0027){PL\u003dFiltro[j][6].toString}\r\n        Comp\u003dData.filter(function (v){return v[1].toString()\u003d\u003d\u003dPL})\r\n        }\r\n\r\n        if(Comp.length\u003d\u003d1)\r\n        {var FE\u003dComp[0][4]\r\n         var FF\u003dComp[0][5]\r\n         var SR\u003dComp[0][0].toString()\r\n         var FI\u003dFiltro[j][4]\r\n         var STT\u003dFiltro[j][1].toString()\r\n         if((FI\u003cFF)\u0026\u0026(FI\u003e0)\u0026\u0026(FF\u003e0))\r\n         { var INFO\u003d[\u0027VIGENTE\u0027,Comp[0][9],Comp[0][10]];\r\n         }if((FI\u003eFF)\u0026\u0026(FI\u003e0)\u0026\u0026(FF\u003e0)){ INFO\u003d[\u0027VENCIDA\u0027,\u0027VENTA DE SERVICIO\u0027,\u0027N/A\u0027];}\r\n           var k\u003di+j\r\n           Logger.log(\"k\u003d \"+k)\r\n           var II\u003dD_Hoja[k][5]\r\n           Logger.log(\u0027SERvicio\u003d\u0027+STT)\r\n           Logger.log(\u0027Index\u003d\u0027+II)\r\n         var SRR\u003dST.getRange(\u0027T\u0027+II).getValue().toString()\r\n         if(SRR!\u003dSR)\r\n         {ST.getRange(\u0027T\u0027+II).setNote(\"Ingres√≥ como \"+SRR)\r\n          ST.getRange(\u0027T\u0027+II).setValue(SR)\r\n         } ST.getRange(\u0027X\u0027+II).setValue(FE)\r\n         ST.getRange(\u0027Z\u0027+II+\u0027:AB\u0027+II).setValues([INFO])\r\n        }\r\n      } i\u003di+j-1\r\n        F\u003d1\r\n    }\r\n    else\r\n    { var D_NO_VEN\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027NO VENDIDO\u0027).getDataRange().getValues()\r\n      var MODD\u003dD_Hoja[i][3].toString()\r\n      var CLIENT\u003dD_Hoja[i][2].toString()\r\n      var STT\u003dD_Hoja[i][1]\r\n      var II\u003dD_Hoja[i][5] \r\n     \r\n      SR\u003dD_Hoja[i][0].toString()\r\n      var Comp2\u003dD_GTIA.filter(function (v){return v[0].toString()\u003d\u003d\u003dSR})\r\n      \r\n      if(Comp2.length\u003d\u003d1)\r\n      { var FE\u003dComp2[0][4]\r\n        var FF\u003dComp2[0][5]\r\n        var FI\u003dD_Hoja[i][4]\r\n        if((FI\u003cFF)\u0026\u0026(FI\u003e0)\u0026\u0026(FF\u003e0))\r\n         { var INFO\u003d[\u0027VIGENTE\u0027,Comp2[0][6],Comp2[0][7]];\r\n         }if((FI\u003eFF)\u0026\u0026(FI\u003e0)\u0026\u0026(FF\u003e0)){ INFO\u003d[\u0027VENCIDA\u0027,\u0027VENTA DE SERVICIO\u0027,\u0027N/A\u0027];}\r\n           \r\n           Logger.log(\u0027SErvicio\u003d\u0027+STT)\r\n           Logger.log(\u0027Index\u003d\u0027+II)\r\n           ST.getRange(\u0027X\u0027+II).setValue(FE)\r\n           ST.getRange(\u0027Z\u0027+II+\u0027:AB\u0027+II).setValues([INFO])\r\n      } \r\n\r\n      if(Comp2.length\u003d\u003d0)\r\n      { var Comp3\u003dD_NO_VEN.filter(function (v){return v[0].toString()\u003d\u003d\u003dCLIENT\u0026\u0026v[1].toString()\u003d\u003d\u003dMODD})\r\n        Logger.log(\"C\u0026M\u003d \"+CLIENT+MODD)\r\n        Logger.log(\"Comp3\u003d \"+Comp3)\r\n        if(Comp3.length\u003d\u003d1)\r\n        {ST.getRange(\u0027X\u0027+II).setValue(\u0027N/A\u0027)\r\n          ST.getRange(\u0027Z\u0027+II).setValue(\"NO VENDIDO POR WM\")}\r\n      }\r\n         \r\n    }\r\n  }\r\n} \r\n\r\nfunction DIR_GTIA2()\r\n{ SERIAL_GTIA()\r\n  SpreadsheetApp.flush()\r\n\r\n  var ST\u003dSpreadsheetApp.openById(\"1CGx8qzzzq1k4kGK0tLT5A3qzgbThyyVB2uk7ayvbv0Q\").getSheetByName(\u0027GLOBAL\u0027)\r\n  var D_ST\u003dST.getRange(\u0027D:D\u0027).getValues().map(function (v,i){return [v[0],i+1]})\r\n\r\n  var Hoja\u003d SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027VAL\u0027);\r\n  var D_Hoja\u003dHoja.getDataRange().getValues()\r\n  var Ult\u003dD_Hoja.length\r\n\r\n  var Enlaces\u003d SpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027ENLACES\u0027);\r\n  var D_Enl\u003dEnlaces.getDataRange().getValues()\r\n  \r\n  var D_GTIA\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027GTIA\u0027).getDataRange().getValues()\r\n  var D_Hoja\u003dHoja.getDataRange().getValues()\r\n\r\n  var Mod\u003dD_Enl.map(function (v){return v[0]}).concat()\r\n\r\n   for(i\u003dUlt-1;i\u003e\u003d0;i--)\r\n  { Logger.log(\"i\u003d\"+i)\r\n    var MODD\u003dD_Hoja[i][3]\r\n    var Index\u003dMod.indexOf(MODD,0)\r\n    if((Index\u003e-1))\r\n    { var HH\u003dSpreadsheetApp.openById(D_Enl[Index][1])\r\n      var Data\u003dHH.getDataRange().getValues()\r\n      var Filtro\u003dD_Hoja.filter(function (v){return v[3]\u003d\u003d\u003dMODD})\r\n      var LL\u003dFiltro.length\r\n      Logger.log(\"LL\u003d \"+LL)\r\n           \r\n      for(j\u003dLL-1;j\u003e\u003d0;j--)\r\n      { Logger.log(\"j\u003d\"+j)\r\n        var SS\u003dFiltro[j][0].toString()\r\n        \r\n        var Comp\u003dData.filter(function (v){return v[0].toString()\u003d\u003d\u003dSS})\r\n        Logger.log(\"SS\u003d \"+Comp)\r\n        var MM\u003dMODD.toString().indexOf(\"ARMOR\",0)\r\n        var MM2\u003dMODD.toString().indexOf(\"NLV-4001\",0)\r\n        var MM3\u003dMODD.toString().indexOf(\"FM100\",0)\r\n        if((Comp.length\u003d\u003d0)\u0026\u0026(MM\u003e-1)){Comp\u003dData.filter(function (v){return v[13].toString()\u003d\u003d\u003dSS||v[14].toString()\u003d\u003d\u003dSS})}\r\n        if(((Comp.length\u003d\u003d0)\u0026\u0026(MM2\u003e-1))||((Comp.length\u003d\u003d0)\u0026\u0026(MM3\u003e-1)))\r\n        {var PL\u003dFiltro[j][6].toString().slice(-6)\r\n        if(PL.toString().slice(0,1)\u003d\u003d\u00270\u0027){PL\u003dFiltro[j][6].toString}\r\n        Comp\u003dData.filter(function (v){return v[1].toString()\u003d\u003d\u003dPL})\r\n        }\r\n\r\n        if(Comp.length\u003d\u003d1)\r\n        {var FE\u003dComp[0][4]\r\n         var FF\u003dComp[0][5]\r\n         var SR\u003dComp[0][0].toString()\r\n         var FI\u003dFiltro[j][4]\r\n         var STT\u003dFiltro[j][1].toString()\r\n         if((FI\u003cFF)\u0026\u0026(FI\u003e0)\u0026\u0026(FF\u003e0))\r\n         { var INFO\u003d[\u0027VIGENTE\u0027,Comp[0][9],Comp[0][10]];\r\n         }if((FI\u003eFF)\u0026\u0026(FI\u003e0)\u0026\u0026(FF\u003e0)){ INFO\u003d[\u0027VENCIDA\u0027,\u0027VENTA DE SERVICIO\u0027,\u0027N/A\u0027];}\r\n           var k\u003di-(LL-j)+1\r\n           Logger.log(\"k\u003d \"+k)\r\n           var II\u003dD_Hoja[k][5]\r\n           Logger.log(\u0027SERvicio\u003d\u0027+STT)\r\n           Logger.log(\u0027Index\u003d\u0027+II)\r\n         var SRR\u003dST.getRange(\u0027T\u0027+II).getValue().toString()\r\n         if(SRR!\u003dSR)\r\n         {ST.getRange(\u0027T\u0027+II).setNote(\"Ingres√≥ como \"+SRR)\r\n          ST.getRange(\u0027T\u0027+II).setValue(SR)\r\n         } ST.getRange(\u0027X\u0027+II).setValue(FE)\r\n         ST.getRange(\u0027Z\u0027+II+\u0027:AB\u0027+II).setValues([INFO])\r\n        }\r\n      } i\u003di-(LL-j)\r\n        F\u003d1\r\n    }\r\n    else\r\n    { var D_NO_VEN\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027NO VENDIDO\u0027).getDataRange().getValues()\r\n      var MODD\u003dD_Hoja[i][3].toString()\r\n      var CLIENT\u003dD_Hoja[i][2].toString()\r\n      var STT\u003dD_Hoja[i][1]\r\n      var II\u003dD_Hoja[i][5] \r\n     \r\n      SR\u003dD_Hoja[i][0].toString()\r\n      var Comp2\u003dD_GTIA.filter(function (v){return v[0].toString()\u003d\u003d\u003dSR})\r\n      \r\n      if(Comp2.length\u003d\u003d1)\r\n      { var FE\u003dComp2[0][4]\r\n        var FF\u003dComp2[0][5]\r\n        var FI\u003dD_Hoja[i][4]\r\n        if((FI\u003cFF)\u0026\u0026(FI\u003e0)\u0026\u0026(FF\u003e0))\r\n         { var INFO\u003d[\u0027VIGENTE\u0027,Comp2[0][6],Comp2[0][7]];\r\n         }if((FI\u003eFF)\u0026\u0026(FI\u003e0)\u0026\u0026(FF\u003e0)){ INFO\u003d[\u0027VENCIDA\u0027,\u0027VENTA DE SERVICIO\u0027,\u0027N/A\u0027];}\r\n           \r\n           Logger.log(\u0027SErvicio\u003d\u0027+STT)\r\n           Logger.log(\u0027Index\u003d\u0027+II)\r\n           ST.getRange(\u0027X\u0027+II).setValue(FE)\r\n           ST.getRange(\u0027Z\u0027+II+\u0027:AB\u0027+II).setValues([INFO])\r\n      } \r\n\r\n      if(Comp2.length\u003d\u003d0)\r\n      { var Comp3\u003dD_NO_VEN.filter(function (v){return v[0].toString()\u003d\u003d\u003dCLIENT\u0026\u0026v[1].toString()\u003d\u003d\u003dMODD})\r\n        Logger.log(\"C\u0026M\u003d \"+CLIENT+MODD)\r\n        Logger.log(\"Comp3\u003d \"+Comp3)\r\n        if(Comp3.length\u003d\u003d1)\r\n        {ST.getRange(\u0027X\u0027+II).setValue(\u0027N/A\u0027)\r\n          ST.getRange(\u0027Z\u0027+II).setValue(\"NO VENDIDO POR WM\")}\r\n      }\r\n         \r\n    }\r\n  }\r\n} \r\n\r\n\r\n\r\nfunction SERIAL_GTIA()\r\n{ var GLOBAL\u003dSpreadsheetApp.openById(\"1CGx8qzzzq1k4kGK0tLT5A3qzgbThyyVB2uk7ayvbv0Q\").getSheetByName(\u0027GLOBAL\u0027) //Clientes\r\n  var D_GLOBAL\u003dGLOBAL.getRange(\u0027D:AB\u0027).getValues()\r\n  var VAL\u003dSpreadsheetApp.getActiveSpreadsheet().getSheetByName(\u0027VAL\u0027)\r\n  var UU\u003dVAL.getDataRange().getLastRow()\r\n  Logger.log(UU)\r\n\r\n  var Filtro\u003dD_GLOBAL.map(function (v,i){return [v[16].valueOf().toString(),v[0],v[3],v[14],v[4],i+1,v[22],v[20],v[17]]}).filter(function (v){return v[1]!\u003d\u003d\"\"\u0026\u0026v[0]!\u003d\u003d\"\"\u0026\u0026(v[6]\u003d\u003d\u003d\"\"||v[7]\u003d\u003d\u003d\"\")\u0026\u0026v[5]\u003e3})\r\n\r\n  L\u003dFiltro.length+1\r\n  var Filtro2\u003dFiltro.map(function (v){return [v[0],v[1],v[2],v[3],v[4],v[5],v[8]]})\r\n\r\n  VAL.getRange(\u0027A2:G\u0027+UU).clearContent()\r\n  VAL.getRange(\u0027A2:G\u0027+L).setValues(Filtro2)\r\n\r\n  VAL.getRange(\u0027A2:G\u0027+L).sort({column: 4, ascending: true})\r\n  \r\n}\r\n\r\n"}]}